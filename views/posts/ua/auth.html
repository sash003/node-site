
JWT, Passport.js —Ç–∞ —Å–µ—Å—ñ—ó –≤ Node.js ‚Äî —Ü–µ –æ—Å–Ω–æ–≤–∞ –¥–ª—è –±–µ–∑–ø–µ—á–Ω–æ—ó –∞–≤—Ç–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—ó –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤. –†–æ–∑–≥–ª—è–Ω–µ–º–æ –ø—ñ–¥—Ö–æ–¥–∏ —Ç–∞ –≤—ñ–¥–º—ñ–Ω–Ω–æ—Å—Ç—ñ –º—ñ–∂ –∑–±–µ—Ä—ñ–≥–∞–Ω–Ω—è–º –¥–∞–Ω–∏—Ö —É cookie —Ç–∞ localStorage.

<h2>–©–æ —Ç–∞–∫–µ –∞–≤—Ç–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—è —Ç–∞ —Å–µ—Å—ñ—ó</h2>
–ê–≤—Ç–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—è ‚Äî –ø—Ä–æ—Ü–µ—Å –ø—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–Ω—è –æ—Å–æ–±–∏ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞.
–°–µ—Å—ñ—è ‚Äî —Ü–µ —Å–ø–æ—Å—ñ–± –∑–±–µ—Ä—ñ–≥–∞—Ç–∏ —Å—Ç–∞–Ω –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ –º—ñ–∂ –∑–∞–ø–∏—Ç–∞–º–∏. –£ –≤–µ–±-–¥–æ–¥–∞—Ç–∫–∞—Ö —Å–µ—Å—ñ—ó –ø–æ—Ç—Ä—ñ–±–Ω—ñ, —â–æ–± –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á –∑–∞–ª–∏—à–∞–≤—Å—è ¬´–≤ —Å–∏—Å—Ç–µ–º—ñ¬ª –±–µ–∑ –ø–æ–≤—Ç–æ—Ä–Ω–æ–≥–æ –ª–æ–≥—ñ–Ω—É –Ω–∞ –∫–æ–∂–Ω–æ–º—É –∑–∞–ø–∏—Ç—ñ.

<h2>JWT (JSON Web Token)</h2>
JWT ‚Äî —Ü–µ –∫–æ–º–ø–∞–∫—Ç–Ω–∏–π —Ç–æ–∫–µ–Ω, —è–∫–∏–π –º–æ–∂–Ω–∞ –ø–µ—Ä–µ–¥–∞–≤–∞—Ç–∏ –º—ñ–∂ –∫–ª—ñ—î–Ω—Ç–æ–º —Ç–∞ —Å–µ—Ä–≤–µ—Ä–æ–º.
–í—ñ–Ω —Å–∫–ª–∞–¥–∞—î—Ç—å—Å—è –∑ —Ç—Ä—å–æ—Ö —á–∞—Å—Ç–∏–Ω: header, payload —Ç–∞ signature.
–¢–æ–∫–µ–Ω —Å—Ç–≤–æ—Ä—é—î—Ç—å—Å—è —Å–µ—Ä–≤–µ—Ä–æ–º –ø—ñ—Å–ª—è —É—Å–ø—ñ—à–Ω–æ–≥–æ –ª–æ–≥—ñ–Ω—É —ñ –ø—ñ–¥–ø–∏—Å—É—î—Ç—å—Å—è —Å–µ–∫—Ä–µ—Ç–æ–º.
–ö–ª—ñ—î–Ω—Ç –∑–±–µ—Ä—ñ–≥–∞—î —Ç–æ–∫–µ–Ω —ñ –≤—ñ–¥–ø—Ä–∞–≤–ª—è—î –π–æ–≥–æ –≤ –∫–æ–∂–Ω–æ–º—É –∑–∞–ø–∏—Ç—ñ (–∑–∞–∑–≤–∏—á–∞–π —É –∑–∞–≥–æ–ª–æ–≤–∫—É Authorization).

<h2>Passport.js</h2>
Passport.js ‚Äî –ø–æ–ø—É–ª—è—Ä–Ω–∏–π middleware –¥–ª—è Node.js, —è–∫–∏–π —Å–ø—Ä–æ—â—É—î –∞–≤—Ç–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—é.
–í—ñ–Ω –ø—ñ–¥—Ç—Ä–∏–º—É—î –ª–æ–∫–∞–ª—å–Ω—ñ —Å—Ç—Ä–∞—Ç–µ–≥—ñ—ó (–ª–æ–≥—ñ–Ω + –ø–∞—Ä–æ–ª—å), OAuth (Google, Facebook), JWT —Ç–∞ —ñ–Ω—à—ñ.
–ü—Ä–∏–∫–ª–∞–¥ –∑ –ª–æ–∫–∞–ª—å–Ω–æ—é —Å—Ç—Ä–∞—Ç–µ–≥—ñ—î—é:
<pre><code class="language-javascript">
const passport = require('passport');
const LocalStrategy = require('passport-local').Strategy;

passport.use(new LocalStrategy(
  function(username, password, done) {
    User.findOne({ username }, function(err, user) {
      if (err) return done(err);
      if (!user) return done(null, false);
      if (!user.verifyPassword(password)) return done(null, false);
      return done(null, user);
    });
  }
));
</code></pre>

<h2>Cookie vs localStorage</h2>
–û–±–∏–¥–≤–∞ –≤–∞—Ä—ñ–∞–Ω—Ç–∏ –º–æ–∂—É—Ç—å –∑–±–µ—Ä—ñ–≥–∞—Ç–∏ —Ç–æ–∫–µ–Ω–∏ –∞–±–æ —Å–µ—Å—ñ–π–Ω—ñ –¥–∞–Ω—ñ, –∞–ª–µ —î –≤—ñ–¥–º—ñ–Ω–Ω–æ—Å—Ç—ñ:

<strong>Cookie</strong>
<ul>
  <li>–í—ñ–¥–ø—Ä–∞–≤–ª—è—î—Ç—å—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –∑ –∫–æ–∂–Ω–∏–º HTTP-–∑–∞–ø–∏—Ç–æ–º –¥–æ –¥–æ–º–µ–Ω—É.</li>
  <li>–ú–æ–∂–µ –±—É—Ç–∏ HttpOnly ‚Äî –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞ –∑ JS, –∑–∞—Ö–∏—â–∞—î –≤—ñ–¥ XSS.</li>
  <li>–ú–æ–∂–Ω–∞ –≤—Å—Ç–∞–Ω–æ–≤–∏—Ç–∏ —Ç–µ—Ä–º—ñ–Ω –∂–∏—Ç—Ç—è, –¥–æ–º–µ–Ω —ñ —à–ª—è—Ö.</li>
</ul>

<strong>localStorage</strong>
<ul>
  <li>–î–æ—Å—Ç—É–ø–Ω–∞ —Ç—ñ–ª—å–∫–∏ —á–µ—Ä–µ–∑ JavaScript.</li>
  <li>–ù–µ –≤—ñ–¥–ø—Ä–∞–≤–ª—è—î—Ç—å—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –Ω–∞ —Å–µ—Ä–≤–µ—Ä.</li>
  <li>–í—Ä–∞–∑–ª–∏–≤–∞ –¥–æ XSS, –∞–ª–µ –ø—Ä–æ—Å—Ç—ñ—à–∞ –¥–ª—è SPA (single-page applications).</li>
</ul>

<h2>–ü—Ä–∏–∫–ª–∞–¥ –∑ JWT —Ç–∞ cookie</h2>
1. –°–µ—Ä–≤–µ—Ä —Å—Ç–≤–æ—Ä—é—î JWT –ø—ñ—Å–ª—è –ª–æ–≥—ñ–Ω—É:
<pre><code class="language-javascript">
const jwt = require('jsonwebtoken');
const token = jwt.sign({ id: user.id }, 'secret', { expiresIn: '1h' });
res.cookie('token', token, { httpOnly: true });
res.send({ success: true });
</code></pre>
2. –ö–ª—ñ—î–Ω—Ç –ø—Ä–∏ –∫–æ–∂–Ω–æ–º—É –∑–∞–ø–∏—Ç—ñ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î cookie –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ.
3. –ù–∞ —Å–µ—Ä–≤–µ—Ä—ñ –ø–µ—Ä–µ–≤—ñ—Ä–∫–∞ —Ç–æ–∫–µ–Ω–∞:
<pre><code class="language-javascript">
const token = req.cookies.token;
jwt.verify(token, 'secret', (err, decoded) => {
  if (err) return res.status(401).send('Unauthorized');
  req.user = decoded;
  next();
});
</code></pre>

<h2>–í–∏—Å–Ω–æ–≤–æ–∫</h2>
<ul>
  <li>–î–ª—è REST API —Ç–∞ SPA —á–∞—Å—Ç–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—Ç—å JWT + localStorage.</li>
  <li>–î–ª—è —Ç—Ä–∞–¥–∏—Ü—ñ–π–Ω–∏—Ö —Å–µ—Ä–≤–µ—Ä–Ω–∏—Ö –¥–æ–¥–∞—Ç–∫—ñ–≤ –∑ —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–æ–º HTML –∑—Ä—É—á–Ω—ñ—à–µ WT –∞–±–æ —Å–µ—Å—ñ—ó –≤ HttpOnly cookie.</li>
  <li>Passport.js —Å–ø—Ä–æ—â—É—î —Ä–æ–±–æ—Ç—É –∑ —Ä—ñ–∑–Ω–∏–º–∏ —Å—Ç—Ä–∞—Ç–µ–≥—ñ—è–º–∏.</li>
</ul>
–ü—Ä–∞–≤–∏–ª—å–Ω–∞ –∫–æ–º–±—ñ–Ω–∞—Ü—ñ—è –∑–∞–ª–µ–∂–∏—Ç—å –≤—ñ–¥ —Ç–∏–ø—É –¥–æ–¥–∞—Ç–∫–∞, –≤–∏–º–æ–≥ –±–µ–∑–ø–µ–∫–∏ —Ç–∞ –∞—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä–∏.

<h2>–ü—Ä–∏–∫–ª–∞–¥ –∞–≤—Ç–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—ó Node.js + Express –∑ Passport.js, JWT —Ç–∞ cookie</h2>

<h2>–í—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è –∑–∞–ª–µ–∂–Ω–æ—Å—Ç–µ–π</h2>
<pre><code class="language-javascript">
npm install express passport passport-local jsonwebtoken cookie-parser body-parser bcrypt
</code></pre>

<h2>–§—Ä–æ–Ω—Ç–µ–Ω–¥</h2>
HTML + jQuery —Ñ–æ—Ä–º–∞ –ª–æ–≥—ñ–Ω—É/–ª–æ–≥–∞—É—Ç—É + –ø–µ—Ä–µ–≤—ñ—Ä–∫–∞ –ø—Ä–æ—Ñ—ñ–ª—é
<pre><code class="language-html">
<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="UTF-8">
  <title>–ê–≤—Ç–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—è JWT + cookie</title>
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<body>
  <h2>–í—Ö—ñ–¥</h2>
  <form id="loginForm">
    <input type="text" id="username" placeholder="–õ–æ–≥—ñ–Ω" required><br>
    <input type="password" id="password" placeholder="–ü–∞—Ä–æ–ª—å" required><br>
    <button type="submit">–£–≤—ñ–π—Ç–∏</button>
  </form>

  <button id="logoutBtn" style="display:none;">–í–∏–π—Ç–∏</button>
  <button id="profileBtn" style="display:none;">–ú—ñ–π –ø—Ä–æ—Ñ—ñ–ª—å</button>

  <div id="output"></div>

  <script>
    // –õ–æ–≥—ñ–Ω
    $('#loginForm').on('submit', function (e) {
      e.preventDefault();
      $.ajax({
        url: '/login',
        method: 'POST',
        contentType: 'application/json',
        data: JSON.stringify({
          username: $('#username').val(),
          password: $('#password').val()
        }),
        success: function (res) {
          $('#output').text(res.message);
          $('#loginForm').hide();
          $('#logoutBtn, #profileBtn').show();
        },
        error: function (xhr) {
          $('#output').text(xhr.responseJSON?.message || '–ü–æ–º–∏–ª–∫–∞ –≤—Ö–æ–¥—É');
        }
      });
    });

    // –ü—Ä–æ—Ñ—ñ–ª—å
    $('#profileBtn').on('click', function () {
      $.ajax({
        url: '/profile',
        method: 'GET',
        success: function (res) {
          $('#output').text(res.message);
        },
        error: function () {
          $('#output').text('–ù–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–æ');
        }
      });
    });

    // –í–∏—Ö—ñ–¥
    $('#logoutBtn').on('click', function () {
      $.ajax({
        url: '/logout',
        method: 'POST',
        success: function (res) {
          $('#output').text(res.message);
          $('#loginForm').show();
          $('#logoutBtn, #profileBtn').hide();
        }
      });
    });
  </script>
</body>
</html>
</code></pre>
<h2>app.js ‚Äî –æ—Å–Ω–æ–≤–Ω–æ–π —Å–µ—Ä–≤–µ—Ä</h2>
<pre><code class="language-javascript">
const express = require('express');
const passport = require('passport');
const LocalStrategy = require('passport-local').Strategy;
const jwt = require('jsonwebtoken');
const cookieParser = require('cookie-parser');
const bodyParser = require('body-parser');
const bcrypt = require('bcrypt');

const app = express();
const port = 3000;

// –§–µ–π–∫–æ–≤–∞ –±–∞–∑–∞ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤ (–∑—Ä–∞–∑—É —Å —Ö–µ—à–µ–º)
const users = [
  { id: 1, username: 'user1', passwordHash: bcrypt.hashSync('password', 10) }
];

// Middleware
app.use(bodyParser.urlencoded({ extended: false }));
app.use(bodyParser.json());
app.use(cookieParser());
app.use(passport.initialize());

// –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ Passport.js (–ª–æ–≥—ñ–Ω/–ø–∞—Ä–æ–ª—å)
passport.use(new LocalStrategy(
  function (username, password, done) {
    const user = users.find(u => u.username === username);
    if (!user) return done(null, false, { message: '–ù–µ–≤—ñ—Ä–Ω–∏–π –ª–æ–≥—ñ–Ω' });

    if (!bcrypt.compareSync(password, user.passwordHash)) {
      return done(null, false, { message: '–ù–µ–≤—ñ—Ä–Ω—ã–π –ø–∞—Ä–æ–ª—å' });
    }

    return done(null, user);
  }
));

// –†–æ—É—Ç –ª–æ–≥–∏–Ω–∞
app.post('/login', (req, res, next) => {
  passport.authenticate('local', (err, user, info) => {
    if (err) return next(err);
    if (!user) return res.status(401).json({ success: false, message: info.message });

    // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è JWT
    const token = jwt.sign(
      { id: user.id, username: user.username },
      'secret',             // —Å–µ–∫—Ä–µ—Ç –¥–ª—è –ø—ñ–¥–ø–∏—Å—É (–ª—É—á—à–µ –≤–∏–Ω–µ—Å—Ç–∏ –≤ .env)
      { expiresIn: '1h' }
    );

    // –û—Ç–ø—Ä–∞–≤–∫–∞ —Ç–æ–∫–µ–Ω–∞ –≤ cookie (HttpOnly)
    res.cookie('token', token, { httpOnly: true });
    res.json({ success: true, message: '–£—Å–ø—ñ—à–Ω—ã–π –≤—Ö–æ–¥' });
  })(req, res, next); // –≤—ã–∑–æ–≤ –∫–æ–ª–±—ç–∫–∞ authenticate
});

// Middleware –¥–ª—è –ø—Ä–æ–≤—ñ—Ä–∫–∏ JWT —ñ–∑ cookie
function authenticateJWT(req, res, next) {
  const token = req.cookies.token;
  if (!token) return res.status(401).send('Unauthorized');

  jwt.verify(token, 'secret', (err, decoded) => {
    if (err) return res.status(401).send('Unauthorized');
    req.user = decoded;
    next();
  });
}

// –ü—Ä–∏–≤–∞—Ç–Ω—ã–π —Ä–æ—É—Ç
app.get('/profile', authenticateJWT, (req, res) => {
  res.json({ message: `–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å, ${req.user.username}` });
});

// Logout
app.post('/logout', (req, res) => {
  res.clearCookie('token');
  res.json({ success: true, message: '–í—ã –≤—ã—à–ª–∏' });
});

// –°—Ç–∞—Ä—Ç —Å–µ—Ä–≤–µ—Ä–∞
app.listen(port, () => console.log(`Server running on http://localhost:${port}`));

</code></pre>
<h2>–Ø–∫ –ø—Ä–∞—Ü—é—î</h2>
- –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á –≤—ñ–¥–ø—Ä–∞–≤–ª—è—î POST –Ω–∞ `/login` –∑ `username` —Ç–∞ `password`.
- Passport –ø–µ—Ä–µ–≤—ñ—Ä—è—î –ª–æ–≥—ñ–Ω —Ç–∞ –ø–∞—Ä–æ–ª—å.
- –Ø–∫—â–æ –≤—Å–µ –ø—Ä–∞–≤–∏–ª—å–Ω–æ, —Å–µ—Ä–≤–µ—Ä —Å—Ç–≤–æ—Ä—é—î JWT —ñ –≤—ñ–¥–ø—Ä–∞–≤–ª—è—î –π–æ–≥–æ –≤ HttpOnly cookie.
- –ë—É–¥—å-—è–∫–∏–π —Ä–æ—É—Ç –∑ middleware `authenticateJWT` –ø–µ—Ä–µ–≤—ñ—Ä—è—î cookie —Ç–∞ —Ä–æ–∑—à–∏—Ñ—Ä–æ–≤—É—î —Ç–æ–∫–µ–Ω.
- Logout –ø—Ä–æ—Å—Ç–æ –æ—á–∏—â—É—î cookie.
<h2>–ë–µ–∑–ø–µ–∫–∞</h2>
- JWT —É cookie HttpOnly –∑–∞—Ö–∏—â–∞—î –≤—ñ–¥ XSS.
- –î–ª—è SPA –º–æ–∂–Ω–∞ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ localStorage, –∞–ª–µ —Ç–æ–¥—ñ –ø–æ—Ç—Ä—ñ–±–Ω–æ –≤—Ä–∞—Ö–æ–≤—É–≤–∞—Ç–∏ CSRF.
- Passport.js –¥–æ–∑–≤–æ–ª—è—î –ª–µ–≥–∫–æ –ø—ñ–¥–∫–ª—é—á–∞—Ç–∏ OAuth —Ç–∞ —ñ–Ω—à—ñ —Å—Ç—Ä–∞—Ç–µ–≥—ñ—ó.

<h2>JWT –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü—ñ—è —á–µ—Ä–µ–∑ LocalStorage</h2>
–§—Ä–æ—Ç–Ω–µ–Ω–¥
<pre><code class="language-html">
<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>JWT + LocalStorage</title>
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <style>
    body { font-family: Arial, sans-serif; margin: 30px; }
    h1 { margin-bottom: 20px; }
    input, button { margin: 5px; padding: 6px; }
    pre { background: #f4f4f4; padding: 10px; border-radius: 5px; margin-top: 10px; }
  </style>
</head>
<body>
<h1>JWT –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü—ñ—è —á–µ—Ä–µ–∑ LocalStorage</h1>

<form id="loginForm">
  <input type="text" id="username" placeholder="–õ–æ–≥–∏–Ω" required>
  <input type="password" id="password" placeholder="–ü–∞—Ä–æ–ª—å" required>
  <button type="submit">–í–æ–π—Ç–∏</button>
</form>

<button id="getProfile">–ü—Ä–æ—Ñ–∏–ª—å</button>
<button id="logout">–í—ã–π—Ç–∏</button>

<pre id="output"></pre>

<script>
  const API = "http://localhost:3000";

  // –õ–æ–≥–∏–Ω
  $("#loginForm").submit(function(e) {
    e.preventDefault();
    $.post(API + "/login", {
      username: $("#username").val(),
      password: $("#password").val()
    }, function(data) {
      if (data.success && data.token) {
        localStorage.setItem("jwt", data.token);
      }
      $("#output").text(JSON.stringify(data, null, 2));
    }).fail(err => {
      $("#output").text("–û—à–∏–±–∫–∞: " + err.responseJSON?.message);
    });
  });

  // –ü—Ä–æ—Ñ–∏–ª—å
  $("#getProfile").click(function() {
    const token = localStorage.getItem("jwt");
    if (!token) return $("#output").text("–ù–µ—Ç —Ç–æ–∫–µ–Ω–∞ –≤ localStorage");

    $.ajax({
      url: API + "/profile",
      method: "GET",
      headers: { "Authorization": "Bearer " + token },
      success: function(data) {
        $("#output").text(JSON.stringify(data, null, 2));
      },
      error: function() {
        $("#output").text("–ù–µ—Ç –¥–æ—Å—Ç—É–ø–∞ (LocalStorage)");
      }
    });
  });

  // –í—ã—Ö–æ–¥
  $("#logout").click(function() {
    localStorage.removeItem("jwt");
    $("#output").text("–í—ã –≤—ã—à–ª–∏ (localStorage –æ—á–∏—â–µ–Ω)");
  });
</script>
</body>
</html>
</code></pre>
–°–µ—Ä–≤–µ—Ä
<pre><code class="language-javascript">
const express = require('express');
const jwt = require('jsonwebtoken');
const bodyParser = require('body-parser');
const bcrypt = require('bcrypt');
const cors = require('cors');

const app = express();
const port = 3000;

// –†–∞–∑—Ä—ñ—à–∞–µ–º CORS (–¥–ª—è —Ñ—Ä–æ–Ω—Ç–∞)
app.use(cors());
app.use(bodyParser.json());
app.use(bodyParser.urlencoded({ extended: false }));

// –ú–æ–∫–∞—î–º –±–∞–∑—É –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤
const users = [
  { id: 1, username: 'user1', passwordHash: bcrypt.hashSync('password', 10) }
];

// –°–µ–∫—Ä–µ—Ç –¥–ª—è JWT
const SECRET = 'super_secret_key';

// –õ–æ–≥—ñ–Ω ‚Äî –≤—ã–¥–∞—ë–º JWT
app.post('/login', (req, res) => {
  const { username, password } = req.body;
  const user = users.find(u => u.username === username);

  if (!user) {
    return res.status(401).json({ success: false, message: '–ù–µ–≤—ñ—Ä–Ω—ã–π –ª–æ–≥—ñ–Ω' });
  }
  if (!bcrypt.compareSync(password, user.passwordHash)) {
    return res.status(401).json({ success: false, message: '–ù–µ–≤—ñ—Ä–Ω—ã–π –ø–∞—Ä–æ–ª—å' });
  }

  const token = jwt.sign({ id: user.id, username: user.username }, SECRET, { expiresIn: '1h' });
  res.json({ success: true, token });
});

// Middleware –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ JWT
function authenticateJWT(req, res, next) {
  const authHeader = req.headers['authorization'];
  if (!authHeader) return res.status(401).json({ message: '–ù–µ—Ç —Ç–æ–∫–µ–Ω–∞' });

  const token = authHeader.split(' ')[1];
  jwt.verify(token, SECRET, (err, decoded) => {
    if (err) return res.status(403).json({ message: '–ù–µ–¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã–π —Ç–æ–∫–µ–Ω' });
    req.user = decoded;
    next();
  });
}

// –ü—Ä–∏–≤–∞—Ç–Ω—ã–π —Ä–æ—É—Ç
app.get('/profile', authenticateJWT, (req, res) => {
  res.json({ message: `–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å, ${req.user.username}` });
});

app.listen(port, () => console.log(`üöÄ Server running on http://localhost:${port}`));
</code></pre>
<h2>–í–∏—Å–Ω–æ–≤–æ–∫</h2>
–ê—É—Ç–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—è ‚Äì —Ü–µ –æ—Å–Ω–æ–≤–∞ –±—É–¥—å-—è–∫–æ—ó —Å—É—á–∞—Å–Ω–æ—ó –≤–µ–±-—Ä–æ–∑—Ä–æ–±–∫–∏. Cookie —ñ LocalStorage, Passport.js —ñ JWT ‚Äî —Ü–µ –ª–∏—à–µ —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∏, —è–∫—ñ –≤–∏—Ä—ñ—à—É—é—Ç—å —Ä—ñ–∑–Ω—ñ –∑–∞–≤–¥–∞–Ω–Ω—è. –ù–µ–º–∞—î ¬´–ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ¬ª —á–∏ ¬´–Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ¬ª –≤–∞—Ä—ñ–∞–Ω—Ç–∞ ‚Äî —î –ø–æ—Ç—Ä—ñ–±–Ω–∏–º –¥–ª—è —Ç–≤–æ–≥–æ –ø—Ä–æ–µ–∫—Ç—É.

–Ø–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–∏–π –∫–ª–∞—Å–∏—á–Ω–∏–π –≤–µ–± —ñ–∑ —Å–µ—Ä–≤–µ—Ä–Ω–∏–º–∏ —à–∞–±–ª–æ–Ω–∞–º–∏ - –±–µ—Ä–∏ cookie + —Å–µ—Å—ñ—ó.
–Ø–∫—â–æ —É —Ç–µ–±–µ SPA –∞–±–æ –º–æ–±—ñ–ª—å–Ω–∏–π –¥–æ–¥–∞—Ç–æ–∫ - –Ω–∞–π—á–∞—Å—Ç—ñ—à–µ –ø—ñ–¥—ñ–π–¥–µ JWT —á–µ—Ä–µ–∑ localStorage –∞–±–æ cookie –∑ HttpOnly.
Passport.js –∑–∞–∫—Ä–∏–≤–∞—î –≤—Å—ñ –ø–∏—Ç–∞–Ω–Ω—è —ñ–Ω—Ç–µ–≥—Ä–∞—Ü—ñ—ó –∑—ñ —Å—Ç–æ—Ä–æ–Ω–Ω—ñ–º–∏ —Å–µ—Ä–≤—ñ—Å–∞–º–∏, –∞ JWT –≥–∞—Ä–Ω–∏–π —Ç–∞–º, –¥–µ –ø–æ—Ç—Ä—ñ–±–Ω–∞ –º–∞—Å—à—Ç–∞–±–æ–≤–∞–Ω—ñ—Å—Ç—å —Ç–∞ –º—ñ–∫—Ä–æ—Å–µ—Ä–≤—ñ—Å–∏.

–ì–æ–ª–æ–≤–Ω–µ –∑–∞–≤–∂–¥–∏ –¥—É–º–∞—Ç–∏ –ø—Ä–æ –±–µ–∑–ø–µ–∫—É: —à–∏—Ñ—Ä—É–≤–∞—Ç–∏ –¥–∞–Ω—ñ, —Å—Ç–∞–≤–∏—Ç–∏ –ø—Ä–∞–≤–∏–ª—å–Ω—ñ –ø—Ä–∞–ø–æ—Ä–∏ –Ω–∞ cookie, –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ HTTPS —ñ –Ω–µ –∑–±–µ—Ä—ñ–≥–∞—Ç–∏ –∑–∞–π–≤–æ–≥–æ –≤ localStorage.

–Ü –ø–∞–º'—è—Ç–∞–π: —Ö–æ—á –±–∏ —è–∫ —Å–∫–ª–∞–¥–Ω–æ —Ü–µ –∑–¥–∞–≤–∞–ª–æ—Å—è, –ø—ñ–¥ –∫–∞–ø–æ—Ç–æ–º –≤—Å–µ –∑–≤–æ–¥–∏—Ç—å—Å—è –¥–æ –ø—Ä–æ—Å—Ç–æ–≥–æ –ø—Ä–∞–≤–∏–ª–∞ ‚Äî —Ç–∏ –¥–∞—î—à –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–µ–≤—ñ —Ç–æ–∫–µ–Ω, –∞ —Å–µ—Ä–≤–µ—Ä –ø–µ—Ä–µ–≤—ñ—Ä—è—î, —â–æ –≤—ñ–Ω —Å–ø—Ä–∞–≤–∂–Ω—ñ–π. –†–µ—à—Ç–∞ ‚Äî –¥–µ—Ç–∞–ª—ñ —Ä–µ–∞–ª—ñ–∑–∞—Ü—ñ—ó.