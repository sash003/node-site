
Node.js –Ω–∞–¥–∞—î –ø–æ—Ç—É–∂–Ω–∏–π –º–æ–¥—É–ª—å fs –¥–ª—è —Ä–æ–±–æ—Ç–∏ –∑ —Ñ–∞–π–ª–∞–º–∏ —Ç–∞ –∫–∞—Ç–∞–ª–æ–≥–∞–º–∏. –í—ñ–Ω –¥–æ–∑–≤–æ–ª—è—î —è–∫ —Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ, —Ç–∞–∫ —ñ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ —á–∏—Ç–∞—Ç–∏ —Ç–∞ –∑–∞–ø–∏—Å—É–≤–∞—Ç–∏ –¥–∞–Ω—ñ, –∫–µ—Ä—É–≤–∞—Ç–∏ –¥–∏—Ä–µ–∫—Ç–æ—Ä—ñ—è–º–∏, —Å—Ç–µ–∂–∏—Ç–∏ –∑–∞ –∑–º—ñ–Ω–∞–º–∏ —Ñ–∞–π–ª—ñ–≤ —Ç–∞ –±—É–¥—É–≤–∞—Ç–∏ –Ω–∞ —Ü—å–æ–º—É –ø–æ–≤–Ω–æ—Ü—ñ–Ω–Ω—ñ —Å–µ—Ä–≤–µ—Ä–Ω—ñ –ø—Ä–æ–≥—Ä–∞–º–∏. –£ —Ü—ñ–π —Å—Ç–∞—Ç—Ç—ñ –º–∏ —Ä–æ–∑–±–µ—Ä–µ–º–æ –æ—Å–Ω–æ–≤–Ω—ñ –º–æ–∂–ª–∏–≤–æ—Å—Ç—ñ fs, –Ω—é–∞–Ω—Å–∏ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ—Å—Ç—ñ —Ç–∞ –¥–∞–º–æ –ø—Ä–∞–∫—Ç–∏—á–Ω—ñ –ø—Ä–∏–∫–ª–∞–¥–∏.
<h2>1. –ú–æ–¥—É–ª—å fs: —Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ñ —Ç–∞ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ñ –º–µ—Ç–æ–¥–∏</h2>
–£ Node.js –±—ñ–ª—å—à—ñ—Å—Ç—å –æ–ø–µ—Ä–∞—Ü—ñ–π —ñ–∑ —Ñ–∞–π–ª–∞–º–∏ –±—É–≤–∞—é—Ç—å –¥–≤–æ—Ö –≤–∏–¥—ñ–≤:
–ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ñ ‚Äì –Ω–µ –±–ª–æ–∫—É—é—Ç—å –æ—Å–Ω–æ–≤–Ω–∏–π –ø–æ—Ç—ñ–∫ –≤–∏–∫–æ–Ω–∞–Ω–Ω—è, –ø—Ä–∞—Ü—é—é—Ç—å —á–µ—Ä–µ–∑ –∫–æ–ª–±–µ–∫–∏ —á–∏ –ø—Ä–æ–º—ñ—Å–∏.
–°–∏–Ω—Ö—Ä–æ–Ω–Ω—ñ ‚Äì –±–ª–æ–∫—É—é—Ç—å –≤–∏–∫–æ–Ω–∞–Ω–Ω—è –∫–æ–¥—É –¥–æ –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—è –æ–ø–µ—Ä–∞—Ü—ñ—ó.

–ü—Ä–∏–∫–ª–∞–¥ –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è:
<pre><code class="language-javascript">
const fs = require('fs');
const path = require('path');
</code></pre>
–°–∏–Ω—Ö—Ä–æ–Ω–Ω–µ —á–∏—Ç–∞–Ω–Ω—è —Ñ–∞–π–ª—É
<pre><code class="language-javascript">
const data = fs.readFileSync(path.join(__dirname, 'example.txt'), 'utf-8');
console.log(data);
</code></pre>
‚ö†Ô∏è –ú—ñ–Ω—É—Å —Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∏—Ö –º–µ—Ç–æ–¥—ñ–≤: –¥–æ–∫–∏ —Ñ–∞–π–ª —á–∏—Ç–∞—î—Ç—å—Å—è, Node.js –Ω–µ –æ–±—Ä–æ–±–ª—è—î —ñ–Ω—à—ñ –∑–∞–ø–∏—Ç–∏. –¢–æ–º—É –Ω–∞ —Å–µ—Ä–≤–µ—Ä—ñ –∑–∞–∑–≤–∏—á–∞–π –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—Ç—å –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ñ –º–µ—Ç–æ–¥–∏.

–ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–µ —á–∏—Ç–∞–Ω–Ω—è —Ñ–∞–π–ª—É (–∫–æ–ª–±–µ–∫)
<pre><code class="language-javascript">
fs.readFile(path.join(__dirname, 'example.txt'), 'utf-8', (err, data) => {
  if (err) {
    console.error('–ü–æ–º–∏–ª–∫–∞ —á–∏—Ç–∞–Ω–Ω—è —Ñ–∞–π–ª–∞:', err);
    return;
  }
  console.log(data);
});
</code></pre>
–ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–µ —á–∏—Ç–∞–Ω–Ω—è —á–µ—Ä–µ–∑ –ø—Ä–æ–º—ñ—Å–∏
<pre><code class="language-javascript">
const fsPromises = fs.promises;
async function readFileAsync() {
  try {
    const data = await fsPromises.readFile(path.join(__dirname, 'example.txt'), 'utf-8');
    console.log(data);
  } catch (err) {
    console.error('–û—à–∏–±–∫–∞:', err);
  }
}

readFileAsync();
</code></pre>
<h2>2. –ó–∞–ø–∏—Å—É–≤–∞–Ω–Ω—è —Ñ–∞–π–ª—ñ–≤</h2>
Node.js –¥–æ–∑–≤–æ–ª—è—î –∑–∞–ø–∏—Å—É–≤–∞—Ç–∏ –¥–∞–Ω—ñ —É —Ñ–∞–π–ª —è–∫ —Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ, —ñ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ.

–ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∏–π –∑–∞–ø–∏—Å –∑ –∫–æ–ª–±–µ–∫–æ–º
<pre><code class="language-javascript">
fs.writeFile('output.txt', '–ü—Ä–∏–≤—ñ—Ç, Node.js!', 'utf-8', (err) => {
  if (err) {
    console.error('–ü–æ–º–∏–ª–∫–∞ –∑–∞–ø–∏—Å—É:', err);
  } else {
    console.log('–§–∞–π–ª —É—Å–ø—ñ—à–Ω–æ –∑–∞–ø–∏—Å–∞–Ω–∏–π!');
  }
});
</code></pre>
–ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∏–π –∑–∞–ø–∏—Å —á–µ—Ä–µ–∑ –ø—Ä–æ–º—ñ—Å–∏
<pre><code class="language-javascript">
async function writeFileAsync() {
  try {
    await fsPromises.writeFile('output.txt', '–ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∏–π –∑–∞–ø–∏—Å —á–µ—Ä–µ–∑ –ø—Ä–æ–º—ñ—Å–∏', 'utf-8');
    console.log('–§–∞–π–ª –∑–∞–ø–∏—Å–∞–Ω–∏–π!');
  } catch (err) {
    console.error('–ü–æ–º–∏–ª–∫–∞:', err);
  }
}

writeFileAsync();
</code></pre>
<h2>3. –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ —ñ—Å–Ω—É–≤–∞–Ω–Ω—è —Ñ–∞–π–ª—ñ–≤ —Ç–∞ –¥–∏—Ä–µ–∫—Ç–æ—Ä—ñ–π</h2>
–ß–∞—Å—Ç–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ –ø–µ—Ä–µ–∫–æ–Ω–∞—Ç–∏—Å—è, —â–æ —Ñ–∞–π–ª —á–∏ –∫–∞—Ç–∞–ª–æ–≥ —ñ—Å–Ω—É—î –ø–µ—Ä–µ–¥ —á–∏—Ç–∞–Ω–Ω—è–º —á–∏ –∑–∞–ø–∏—Å–æ–º.
<pre><code class="language-javascript">
const filePath = path.join(__dirname, 'example.txt');
fs.access(filePath, fs.constants.F_OK, (err) => {
  if (err) {
    console.log('–§–∞–π–ª –Ω–µ —ñ—Å–Ω—É—î');
  } else {
    console.log('–§–∞–π–ª —ñ—Å–Ω—É—î');
  }
});
</code></pre>
<h2>4. –†–æ–±–æ—Ç–∞ –∑ –¥–∏—Ä–µ–∫—Ç–æ—Ä—ñ—è–º–∏</h2>
–°—Ç–≤–æ—Ä–µ–Ω–Ω—è, —á–∏—Ç–∞–Ω–Ω—è —Ç–∞ –≤–∏–¥–∞–ª–µ–Ω–Ω—è –ø–∞–ø–æ–∫ —Ç–∞–∫–æ–∂ –ø—ñ–¥—Ç—Ä–∏–º—É—î—Ç—å—Å—è —á–µ—Ä–µ–∑ fs.

–°—Ç–≤–æ—Ä–µ–Ω–Ω—è –ø–∞–ø–∫–∏
<pre><code class="language-javascript">
fs.mkdir(path.join(__dirname, 'uploads'), { recursive: true }, (err) => {
  if (err) console.error(err);
  else console.log('–ü–∞–ø–∫–∞ —Å—Ç–≤–æ—Ä–µ–Ω–∞!');
});
</code></pre>
recursive: true –¥–æ–∑–≤–æ–ª—è—î —Å—Ç–≤–æ—Ä—é–≤–∞—Ç–∏ –≤–∫–ª–∞–¥–µ–Ω—ñ –¥–∏—Ä–µ–∫—Ç–æ—Ä—ñ—ó, –Ω–∞–≤—ñ—Ç—å —è–∫—â–æ –Ω–µ —ñ—Å–Ω—É—é—Ç—å –±–∞—Ç—å–∫—ñ–≤—Å—å–∫—ñ.

–ß–∏—Ç–∞–Ω–Ω—è –≤–º—ñ—Å—Ç—É –¥–∏—Ä–µ–∫—Ç–æ—Ä—ñ—ó
<pre><code class="language-javascript">
fs.readdir(__dirname, (err, files) => {
  if (err) console.error(err);
  else console.log('–§–∞–π–ª–∏ –≤ –ø–∞–ø—Ü—ñ:', files);
});
</code></pre>
–í–∏–¥–∞–ª–µ–Ω–Ω—è –ø–∞–ø–∫–∏
<pre><code class="language-javascript">
fs.rmdir(path.join(__dirname, 'uploads'), { recursive: true }, (err) => {
  if (err) console.error(err);
  else console.log('–ü–∞–ø–∫–∞ –≤–∏–¥–∞–ª–µ–Ω–∞!');
});
</code></pre>
<h2>5. –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ñ—Å—Ç—å —Ç–∞ –ø–æ–¥—ñ—ó</h2>
–ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ñ –º–µ—Ç–æ–¥–∏ –¥–∞—é—Ç—å –∑–º–æ–≥—É –Ω–µ –±–ª–æ–∫—É–≤–∞—Ç–∏ Event Loop. –ù–∞–ø—Ä–∏–∫–ª–∞–¥, —Å–µ—Ä–≤–µ—Ä Node.js –º–æ–∂–µ –æ–±—Ä–æ–±–ª—è—Ç–∏ –∑–∞–ø–∏—Ç–∏ HTTP, –ø–æ–∫–∏ —á–∏—Ç–∞—î—Ç—å—Å—è —Ñ–∞–π–ª.
–î–ª—è –≤–µ–ª–∏–∫–∏—Ö —Ñ–∞–π–ª—ñ–≤ –º–æ–∂–Ω–∞ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ –ø–æ—Ç–æ–∫–∏ (Streams):
<pre><code class="language-javascript">
const readStream = fs.createReadStream('bigfile.txt', 'utf-8');

readStream.on('data', chunk => {
  console.log('–ü—Ä–æ—á–∏—Ç–∞–Ω–æ:', chunk.length, '—Å–∏–º–≤–æ–ª—ñ–≤');
});

readStream.on('end', () => {
  console.log('–ß–∏—Ç–∞–Ω–Ω—è –∑–∞–≤–µ—Ä—à–µ–Ω–æ');
});
</code></pre>
–í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—á–∏ –ø–æ—Ç–æ–∫–∏, –≤–∏ —É–Ω–∏–∫–∞—î—Ç–µ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –≤—Å—å–æ–≥–æ —Ñ–∞–π–ª—É –Ω–∞ –∑–≥–∞–¥–∫—É.
<h2>6. –ü—Ä–∞–∫—Ç–∏—á–Ω–∏–π –ø—Ä–∏–∫–ª–∞–¥: –ª–æ–≥—É–≤–∞–Ω–Ω—è –∑–∞–ø–∏—Ç—ñ–≤</h2>
<pre><code class="language-javascript">
const http = require ('http');

http.createServer(async(req, res) => {
  const logLine = `${new Date().toISOString()} ${req.method} ${req.url}\n`;

  await fsPromises.appendFile('server.log', logLine);

  res.end('OK');
}).listen(3000, () => console.log('–°–µ—Ä–≤–µ—Ä –Ω–∞ –ø–æ—Ä—Ç—É 3000'));
</code></pre>
–¢—É—Ç appendFile –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ –¥–æ–¥–∞—î —Ä—è–¥–∫–∏ –≤ –±–∞–ª–∫—É, –Ω–µ –±–ª–æ–∫—É—é—á–∏ —Å–µ—Ä–≤–µ—Ä.
<h2>7. –ü–æ—Ä–∞–¥–∏ —â–æ–¥–æ —Ä–æ–±–æ—Ç–∏ –∑ fs</h2>
–í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ñ –º–µ—Ç–æ–¥–∏, —è–∫—â–æ —Ü–µ —Å–µ—Ä–≤–µ—Ä–Ω—ñ –ø—Ä–æ–≥—Ä–∞–º–∏. –°–∏–Ω—Ö—Ä–æ–Ω–Ω—ñ –ª–∏—à–µ –¥–ª—è —Å–∫—Ä–∏–ø—Ç—ñ–≤ –∞–±–æ CLI.
–ü–µ—Ä–µ–≤—ñ—Ä—è–π—Ç–µ –ø–æ–º–∏–ª–∫–∏ –∑–∞–≤–∂–¥–∏, –æ—Å–æ–±–ª–∏–≤–æ –ø—ñ–¥ —á–∞—Å –∑–∞–ø–∏—Å—É/—á–∏—Ç–∞–Ω–Ω—è —Ñ–∞–π–ª—ñ–≤.
–í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π –ø–æ—Ç–æ–∫–∏ –¥–ª—è –≤–µ–ª–∏–∫–∏—Ö —Ñ–∞–π–ª—ñ–≤ ‚Äì –∑–∞–æ—â–∞–¥–∂—É—î –ø–∞–º'—è—Ç—å.
–ù–∞–º–∞–≥–∞–π—Å—è –∑–±–µ—Ä—ñ–≥–∞—Ç–∏ —à–ª—è—Ö–∏ —á–µ—Ä–µ–∑ path.join, —â–æ–± –∫–æ–¥ –±—É–≤ –∫—Ä–æ—Å–ø–ª–∞—Ç—Ñ–æ—Ä–º–Ω–∏–º.
Node.js —Ç–∞ –º–æ–¥—É–ª—å fs –¥–∞—é—Ç—å –ø–æ–≤–Ω–∏–π –∫–æ–Ω—Ç—Ä–æ–ª—å –Ω–∞–¥ —Ñ–∞–π–ª–æ–≤–æ—é —Å–∏—Å—Ç–µ–º–æ—é —Å–µ—Ä–≤–µ—Ä–∞. –ó–Ω–∞—é—á–∏, —è–∫ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ñ—Å—Ç—å, –ø–æ—Ç–æ–∫–∏ —Ç–∞ –ø—Ä–æ–º—ñ—Å–∏, –º–æ–∂–Ω–∞ –±—É–¥—É–≤–∞—Ç–∏ –Ω–∞–¥—ñ–π–Ω—ñ –ø—Ä–æ–≥—Ä–∞–º–∏ –∑ –ª–æ–≥–∞–º–∏, –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è–º —Ñ–∞–π–ª—ñ–≤, –≥–µ–Ω–µ—Ä–∞—Ü—ñ—î—é –∫–æ–Ω—Ç–µ–Ω—Ç—É —Ç–∞ –∫–µ—Ä—É–≤–∞–Ω–Ω—è–º –ø–∞–ø–∫–∞–º–∏ –±–µ–∑ —Ä–∏–∑–∏–∫—É –±–ª–æ–∫—É–≤–∞–Ω–Ω—è —Å–µ—Ä–≤–µ—Ä–∞.
<h2>8. –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —Ñ–∞–π–ª—ñ–≤: multer + file-type</h2>
–£ –≤–µ–±-–∑–∞—Å—Ç–æ—Å—É–Ω–∫–∞—Ö —á–∞—Å—Ç–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ –ø—Ä–∏–π–º–∞—Ç–∏ —Ñ–∞–π–ª–∏ –≤—ñ–¥ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤ - –∫–∞—Ä—Ç–∏–Ω–∫–∏, –¥–æ–∫—É–º–µ–Ω—Ç–∏ –∞–±–æ –≤—ñ–¥–µ–æ. –î–ª—è —Ü—å–æ–≥–æ —É Node.js —î –ø–æ–ø—É–ª—è—Ä–Ω–∏–π middleware multer.
–£—Å—Ç–∞–Ω–æ–≤–∫–∞:
<pre><code class="language-javascript">
npm install multer file-type
</code></pre>
–ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Å—Ö–æ–≤–∏—â–∞
<pre><code class="language-javascript">
const multer = require('multer');
const fs = require('fs');
const path = require('path');
const FileType = require('file-type');

// –ù–∞–ª–∞—à—Ç–æ–≤—É—î–º–æ —Å—Ö–æ–≤–∏—â–µ –¥–ª—è —Ñ–∞–π–ª—ñ–≤, —â–æ –∑–∞–≤–∞–Ω—Ç–∞–∂—É—é—Ç—å—Å—è —á–µ—Ä–µ–∑ multer
const storage = multer.diskStorage({
  /* –ö—É–¥–∏ –∑–±–µ—Ä—ñ–≥–∞—Ç–∏ —Ñ–∞–π–ª
  –§—É–Ω–∫—Ü—ñ—è –≤–∏–∫–ª–∏–∫–∞—î—Ç—å—Å—è –¥–ª—è –∫–æ–∂–Ω–æ–≥–æ —Ñ–∞–π–ª—É
  req ‚Äì –¥–∞–Ω—ñ –∑–∞–ø–∏—Ç—É
  file - –æ–±'—î–∫—Ç –∑ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—î—é –ø—Ä–æ —Ñ–∞–π–ª (—ñ–º'—è, —Ç–∏–ø —ñ —Ç.–¥.)
  cb ‚Äì –∫–æ–ª–±–µ–∫, –≤–∫–∞–∑—É—î–º–æ multer –∫—É–¥–∏ –∫–ª–∞—Å—Ç–∏ —Ñ–∞–π–ª */
  destination: (req, file, cb) => {
    // –®–ª—è—Ö –¥–æ –ø–∞–ø–∫–∏ uploads –≤–Ω—É—Ç—Ä–∏ public
    const uploadDir = path.join(__dirname, 'public', 'uploads');

    // –Ø–∫—â–æ –ø–∞–ø–∫–∏ —â–µ –Ω–µ–º–∞—î - —Å—Ç–≤–æ—Ä—é—î–º–æ (recursive: true —Å—Ç–≤–æ—Ä–∏—Ç—å –≤—Å—ñ –≤–∫–ª–∞–¥–µ–Ω—ñ, —è–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ)
    if (!fs.existsSync(uploadDir)) {
      fs.mkdirSync(uploadDir, { recursive: true });
    }

    // –ü–æ–≤—ñ–¥–æ–º–ª—è—î–º–æ multer, –∫—É–¥–∏ —Å–∞–º–µ –∑–±–µ—Ä—ñ–≥–∞—Ç–∏ —Ñ–∞–π–ª
    cb(null, uploadDir);
  },

  // –Ø–∫ –Ω–∞–∑–≤–∞—Ç–∏ —Ñ–∞–π–ª –¥–ª—è –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è
  filename: (req, file, cb) => {
    // –†–æ–±–∏–º–æ —É–Ω—ñ–∫–∞–ª—å–Ω–µ —ñ–º'—è: timestamp + –æ—Ä–∏–≥—ñ–Ω–∞–ª—å–Ω–µ —ñ–º'—è —Ñ–∞–π–ª—É
    // –ù–∞–ø—Ä–∏–∫–ª–∞–¥: 1692718200000-photo.png
    const uniqueName = Date.now() + '-' + file.originalname;

    // –ü–æ–≤—ñ–¥–æ–º–ª—è—î–º–æ multer –Ω–æ–≤–µ –∏–º'—è
    cb(null, uniqueName);
  }
});

//–ó–±–∏—Ä–∞—î–º–æ —Å–∞–º middleware –¥–ª—è –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è
const upload = multer({
storage, // –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î–º–æ —Å—Ö–æ–≤–∏—â–µ, —â–æ –Ω–∞–ª–∞—à—Ç—É–≤–∞–ª–∏ –≤–∏—â–µ
limits: {
fileSize: 10*1024*1024 // –æ–±–º–µ–∂–µ–Ω–Ω—è: 10 –ú–ë –Ω–∞ –æ–¥–∏–Ω —Ñ–∞–π–ª
}
}).any(); // .any() –æ–∑–Ω–∞—á–∞—î –ø—Ä–∏–π–º–∞—Ç–∏ —Ñ–∞–π–ª–∏ –∑ –±—É–¥—å-—è–∫–∏–º–∏ —ñ–º–µ–Ω–∞–º–∏ input'—ñ–≤. –Ø–∫—â–æ —Ö–æ—á–µ—à –∑—Ä–æ–±–∏—Ç–∏ –∂–æ—Ä—Å—Ç–∫—ñ—à–µ (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, —â–æ–± –∑–∞–≤–∞–Ω—Ç–∞–∂—É–≤–∞–ª–æ—Å—è –º–∞–∫—Å–∏–º—É–º 3 —Ñ–∞–π–ª–∏), –º–æ–∂–Ω–∞ –≤—ñ–¥—Ä–∞–∑—É –∑–∞–º—ñ—Å—Ç—å .any() –Ω–∞–ø–∏—Å–∞—Ç–∏ .array('files', 3) ‚Äî —ñ –≤—Å–µ, multer —Å–∞–º –æ–±—Ä—ñ–∂–µ –¥–æ —Ç—Ä—å–æ—Ö.
</code></pre>
–ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ —Ñ–æ—Ä–º–∞—Ç—É —Ñ–∞–π–ª—É

–ù–∞–≤—ñ—Ç—å —è–∫—â–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á –ø–µ—Ä–µ–π–º–µ–Ω—É—î —Ñ–∞–π–ª (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, virus.jpg.exe), –º–∏ –º–æ–∂–µ–º–æ –ø–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ —Ä–µ–∞–ª—å–Ω–∏–π MIME-—Ç–∏–ø —á–µ—Ä–µ–∑ file-type:
<pre><code class="language-javascript">
async function checkFileType(filePath) {
  const buffer = await fs.promises.readFile(filePath);
  const type = await FileType.fromBuffer(buffer);
  return type ? type.mime : null;
}
</code></pre>
–û–±—Ä–æ–±–Ω–∏–∫ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —Ñ–∞–π–ª—ñ–≤
<pre><code class="language-javascript">
const express = require('express');
const app = express();

const ALLOWED_MIME = [
  'image/png',
  'image/jpeg',
  'image/gif',
  'video/mp4',
  'audio/mpeg',
  'application/pdf'
];

app.post('/upload', (req, res) => {
  upload(req, res, async (err) => {
    if (err) {
      return res.status(400).json({ success: false, message: '–ü–æ–º–∏–ª–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏: ' + err.message });
    }

    const files = req.files || [];

    for (const f of files) {
      const filePath = path.join(f.destination, f.filename);
      const mime = await checkFileType(filePath);

      if (!mime || !ALLOWED_MIME.includes(mime)) {
        fs.unlinkSync(filePath); // –≤–∏–¥–∞–ª—è—î–º–æ –Ω–µ–≤—ñ–¥–ø–æ–≤—ñ–¥–Ω–∏–π —Ñ–∞–π–ª
        return res.json({ success: false, message: '–ù–µ–¥–æ–ø—É—Å—Ç–∏–º–∏–π —Ñ–æ—Ä–º–∞—Ç —Ñ–∞–π–ª–∞' });
      }
    }

    res.json({ success: true, message: '–§–∞–π–ª—ã —É—Å–ø—ñ—à–Ω–æ –∑–∞–≥—Ä—É–∂–µ–Ω—ã!' });
  });
});

app.listen(3000, () => console.log('–°–µ—Ä–≤–µ—Ä —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ http://localhost:3000'));
</code></pre>
–©–æ –º–∏ –æ—Ç—Ä–∏–º–∞–ª–∏

–ó–∞–≤–∞–Ω—Ç–∞–∂—É—î–º–æ —Ñ–∞–π–ª–∏ –¥–æ –ø–∞–ø–∫–∏ public/uploads.
–û–±–º–µ–∂–∏–ª–∏ —Ä–æ–∑–º—ñ—Ä 10 –ú–ë.
–ü–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ —Ä–µ–∞–ª—å–Ω–∏–π MIME-—Ç–∏–ø —á–µ—Ä–µ–∑ file-type, –∞ –Ω–µ –ª–∏—à–µ —Ä–æ–∑—à–∏—Ä–µ–Ω–Ω—è.
–Ø–∫—â–æ —Ñ–æ—Ä–º–∞—Ç –Ω–µ –ø—ñ–¥—Ö–æ–¥–∏—Ç—å, —Ñ–∞–π–ª –±—É–¥–µ –≤–∏–¥–∞–ª–µ–Ω–æ.

üí° –£ —Ä–µ–∞–ª—å–Ω–∏—Ö –ø—Ä–æ–µ–∫—Ç–∞—Ö –¥–æ —Ü—å–æ–≥–æ –¥–æ–¥–∞—é—Ç—å —â–µ –ª—ñ–º—ñ—Ç –∑–∞ –∫—ñ–ª—å–∫—ñ—Å—Ç—é —Ñ–∞–π–ª—ñ–≤, –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ –æ—á–∏—â–µ–Ω–Ω—è —Ç–∏–º—á–∞—Å–æ–≤–∏—Ö –¥–∏—Ä–µ–∫—Ç–æ—Ä—ñ–π —Ç–∞ –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—ó –ø—Ä–æ —Ñ–∞–π–ª–∏ –≤ –ë–î.

–¢–∞–∫–∏–º —á–∏–Ω–æ–º, fs+multer+file-type –¥–æ–∑–≤–æ–ª—è—é—Ç—å –±–µ–∑–ø–µ—á–Ω–æ —Ç–∞ –∑—Ä—É—á–Ω–æ –æ–±—Ä–æ–±–ª—è—Ç–∏ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —Ñ–∞–π–ª—ñ–≤ —É Node.js, –Ω–µ —Ä–∏–∑–∏–∫—É—é—á–∏ –¥–æ–ø—É—Å—Ç–∏—Ç–∏ –≤—Ä–∞–∑–ª–∏–≤–æ—Å—Ç—ñ.