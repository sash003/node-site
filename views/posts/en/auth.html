
JWT, Passport.js and sessions in Node.js are the basis for secure user authentication. Let's look at the approaches and differences between storing data in cookies and localStorage.
<h2>What is authentication and sessions</h2>
Authentication is the process of confirming the user's identity.
A session is a way to store the user's state between requests. In web applications, sessions are needed so that the user remains "in the system" without re-logging in for each request.
<h2>JWT (JSON Web Token)</h2>
JWT is a compact token that can be transferred between the client and the server.
It consists of three parts: header, payload and signature.
The token is created by the server after a successful login and signed with a secret.
The client stores the token and sends it in each request (usually in the Authorization header).
<h2>Passport.js</h2>
Passport.js is a popular middleware for Node.js that simplifies authentication.
It supports local strategies (login + password), OAuth (Google, Facebook), JWT and others.
Example with local strategy:
<pre><code class="language-javascript">
const passport = require('passport');
const LocalStrategy = require('passport-local').Strategy;

passport.use(new LocalStrategy(
  function(username, password, done) {
    User.findOne({ username }, function(err, user) {
      if (err) return done(err);
      if (!user) return done(null, false);
      if (!user.verifyPassword(password)) return done(null, false);
      return done(null, user);
    });
  }
));
</code></pre>
<h2>Cookie vs localStorage</h2>
Both options can store tokens or session data, but there are differences:

Cookie
* Automatically sent with each HTTP request to the domain.
* Can be HttpOnly — not accessible from JS, protects against XSS.
* You can set the lifetime, domain, and path.

localStorage
* Only accessible via JavaScript.
* Not automatically sent to the server.
* Vulnerable to XSS, but easier for SPA (single-page applications).
<h2>Example with JWT and cookie</h2>
1. The server creates a JWT after login:
<pre><code class="language-javascript">
const jwt = require('jsonwebtoken');
const token = jwt.sign({ id: user.id }, 'secret', { expiresIn: '1h' });
res.cookie('token', token, { httpOnly: true });
res.send({ success: true });
</code></pre>
2. The client uses the cookie automatically for each request.
3. On the server, check the token:
<pre><code class="language-javascript">
const token = req.cookies.token;
jwt.verify(token, 'secret', (err, decoded) => {
if (err) return res.status(401).send('Unauthorized');
req.user = decoded;
next();
});
</code></pre>
<h2>Conclusion</h2>
- For REST API and SPA, JWT + localStorage is often used.
- For traditional server applications with HTML rendering, WT or sessions in HttpOnly cookie are more convenient.
- Passport.js simplifies working with different strategies.

The right combination depends on the type of application, security requirements and architecture.

<h2>Example of authentication Node.js + Express with Passport.js, JWT and cookie.</h2>
<h2>Installing dependencies</h2>
Before we begin, let's install the necessary packages:
<pre><code class="language-javascript">
npm install express passport passport-local jsonwebtoken cookie-parser body-parser bcrypt
</code></pre>
<h2>Frontend</h2>
HTML + jQuery login/logout form + profile verification
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>JWT + Cookie Authentication</title>
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<body>
<h2>Login</h2>
<form id="loginForm">
  <input type="text" id="username" placeholder="Username" required><br>
  <input type="password" id="password" placeholder="Password" required><br>
  <button type="submit">Login</button>
</form>

<button id="logoutBtn" style="display:none;">Logout</button>
<button id="profileBtn" style="display:none;">My Profile</button>

<div id="output"></div>

<script>
  // Login
  $('#loginForm').on('submit', function (e) {
    e.preventDefault();
    $.ajax({
      url: '/login',
      method: 'POST',
      contentType: 'application/json',
      data: JSON.stringify({
        username: $('#username').val(),
        password: $('#password').val()
      }),
      success: function (res) {
        $('#output').text(res.message);
        $('#loginForm').hide();
        $('#logoutBtn, #profileBtn').show();
      },
      error: function (xhr) {
        $('#output').text(xhr.responseJSON?.message || 'Login error');
      }
    });
  });

  // Profile
  $('#profileBtn').on('click', function () {
    $.ajax({
      url: '/profile',
      method: 'GET',
      success: function (res) {
        $('#output').text(res.message);
      },
      error: function () {
        $('#output').text('Not authorized');
      }
    });
  });

  // Logout
  $('#logoutBtn').on('click', function () {
    $.ajax({
      url: '/logout',
      method: 'POST',
      success: function (res) {
        $('#output').text(res.message);
        $('#loginForm').show();
        $('#logoutBtn, #profileBtn').hide();
      }
    });
  });
</script>
</body>
</html>

<h2>app.js — main server</h2>
<pre><code class="language-javascript">
const express = require('express');
const passport = require('passport');
const LocalStrategy = require('passport-local').Strategy;
const jwt = require('jsonwebtoken');
const cookieParser = require('cookie-parser');
const bodyParser = require('body-parser');
const bcrypt = require('bcrypt');

const app = express();
const port = 3000;

// Fake user database (with pre-hashed password)
const users = [
  { id: 1, username: 'user1', passwordHash: bcrypt.hashSync('password', 10) }
];

// Middleware
app.use(bodyParser.urlencoded({ extended: false }));
app.use(bodyParser.json());
app.use(cookieParser());
app.use(passport.initialize());

// Passport.js strategy (username/password)
passport.use(new LocalStrategy(
  function (username, password, done) {
    const user = users.find(u => u.username === username);
    if (!user) return done(null, false, { message: 'Invalid username' });

    if (!bcrypt.compareSync(password, user.passwordHash)) {
      return done(null, false, { message: 'Invalid password' });
    }

    return done(null, user);
  }
));

// Login route
app.post('/login', (req, res, next) => {
  passport.authenticate('local', (err, user, info) => {
    if (err) return next(err);
    if (!user) return res.status(401).json({ success: false, message: info.message });

    // Generate JWT
    const token = jwt.sign(
      { id: user.id, username: user.username },
      'secret',             // secret for signing (better to keep in .env)
      { expiresIn: '1h' }
    );

    // Send token in HttpOnly cookie
    res.cookie('token', token, { httpOnly: true });
    res.json({ success: true, message: 'Login successful' });
  })(req, res, next); // invoke authenticate callback
});

// Middleware to check JWT from cookie
function authenticateJWT(req, res, next) {
  const token = req.cookies.token;
  if (!token) return res.status(401).send('Unauthorized');

  jwt.verify(token, 'secret', (err, decoded) => {
    if (err) return res.status(401).send('Unauthorized');
    req.user = decoded;
    next();
  });
}

// Private route
app.get('/profile', authenticateJWT, (req, res) => {
  res.json({ message: `Welcome, ${req.user.username}` });
});

// Logout
app.post('/logout', (req, res) => {
  res.clearCookie('token');
  res.json({ success: true, message: 'Logged out' });
});

// Start server
app.listen(port, () => console.log(`Server running on http://localhost:${port}`));
</code></pre>

<h2>How it works</h2>
- The user sends a POST to `/login` with `username` and `password`.
- Passport verifies username and password.
- If everything is correct, the server creates a JWT and sends it in an HttpOnly cookie.
- Any route with the `authenticateJWT` middleware checks the cookie and decodes the token.
- Logout simply clears the cookie.

<h2>Security</h2>
- Storing JWT in an HttpOnly cookie protects against XSS.
- For SPAs you can use localStorage, but then you need to take CSRF into account.
- Passport.js makes it easy to integrate OAuth and other strategies.

<h2>JWT Authentication via LocalStorage</h2>
Frontend
<pre><code class="language-html">
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>JWT + LocalStorage</title>
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <style>
    body { font-family: Arial, sans-serif; margin: 30px; }
    h1 { margin-bottom: 20px; }
    input, button { margin: 5px; padding: 6px; }
    pre { background: #f4f4f4; padding: 10px; border-radius: 5px; margin-top: 10px; }
  </style>
</head>
<body>
<h1>JWT Authentication via LocalStorage</h1>

<form id="loginForm">
  <input type="text" id="username" placeholder="Username" required>
  <input type="password" id="password" placeholder="Password" required>
  <button type="submit">Login</button>
</form>

<button id="getProfile">Profile</button>
<button id="logout">Logout</button>

<pre id="output"></pre>

<script>
  const API = "http://localhost:3000";

  // Login
  $("#loginForm").submit(function(e) {
    e.preventDefault();
    $.post(API + "/login", {
      username: $("#username").val(),
      password: $("#password").val()
    }, function(data) {
      if (data.success && data.token) {
        localStorage.setItem("jwt", data.token);
      }
      $("#output").text(JSON.stringify(data, null, 2));
    }).fail(err => {
      $("#output").text("Error: " + err.responseJSON?.message);
    });
  });

  // Profile
  $("#getProfile").click(function() {
    const token = localStorage.getItem("jwt");
    if (!token) return $("#output").text("No token in localStorage");

    $.ajax({
      url: API + "/profile",
      method: "GET",
      headers: { "Authorization": "Bearer " + token },
      success: function(data) {
        $("#output").text(JSON.stringify(data, null, 2));
      },
      error: function() {
        $("#output").text("Access denied (LocalStorage)");
      }
    });
  });

  // Logout
  $("#logout").click(function() {
    localStorage.removeItem("jwt");
    $("#output").text("Logged out (localStorage cleared)");
  });
</script>
</body>
</html>
</code></pre>
<h2>Server</h2>
<pre><code class="language-javascript">
const express = require('express');
const jwt = require('jsonwebtoken');
const bodyParser = require('body-parser');
const bcrypt = require('bcrypt');
const cors = require('cors');

const app = express();
const port = 3000;

// Allow CORS (for frontend)
app.use(cors());
app.use(bodyParser.json());
app.use(bodyParser.urlencoded({ extended: false }));

// Mock user database
const users = [
  { id: 1, username: 'user1', passwordHash: bcrypt.hashSync('password', 10) }
];

// Secret for JWT
const SECRET = 'super_secret_key';

// Login — issue JWT
app.post('/login', (req, res) => {
  const { username, password } = req.body;
  const user = users.find(u => u.username === username);

  if (!user) {
    return res.status(401).json({ success: false, message: 'Invalid username' });
  }
  if (!bcrypt.compareSync(password, user.passwordHash)) {
    return res.status(401).json({ success: false, message: 'Invalid password' });
  }

  const token = jwt.sign({ id: user.id, username: user.username }, SECRET, { expiresIn: '1h' });
  res.json({ success: true, token });
});

// Middleware to verify JWT
function authenticateJWT(req, res, next) {
  const authHeader = req.headers['authorization'];
  if (!authHeader) return res.status(401).json({ message: 'No token provided' });

  const token = authHeader.split(' ')[1];
  jwt.verify(token, SECRET, (err, decoded) => {
    if (err) return res.status(403).json({ message: 'Invalid token' });
    req.user = decoded;
    next();
  });
}

// Private route
app.get('/profile', authenticateJWT, (req, res) => {
  res.json({ message: `Welcome, ${req.user.username}` });
});

app.listen(port, () => console.log(`🚀 Server running on http://localhost:${port}`));
</code></pre>
<h2>Conclusion</h2>
Authentication is the foundation of any modern web development. Cookies and LocalStorage, Passport.js and JWT — these are just tools that solve different problems. There is no strictly “right” or “wrong” approach — only the one that fits your project.

If you need a classic web app with server-side templates — use cookies + sessions.<

If you are building a SPA or mobile application — most of the time JWT via localStorage or HttpOnly cookies is the right choice.
Passport.js solves all the integration issues with third-party services, while JWT is great where scalability and microservices matter.

The most important thing is always security: encrypt data, set the right cookie flags, use HTTPS, and avoid storing sensitive data in localStorage.

And remember: no matter how complex it looks, under the hood it all boils down to a simple rule — you give the user a token, and the server verifies that it’s valid. Everything else is just implementation details.
