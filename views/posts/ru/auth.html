
JWT, Passport.js –∏ —Å–µ—Å—Å–∏–∏ –≤ Node.js ‚Äî —ç—Ç–æ –æ—Å–Ω–æ–≤–∞ –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ–π –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π. –†–∞–∑–±–µ—Ä—ë–º –ø–æ–¥—Ö–æ–¥—ã –∏ —Ä–∞–∑–ª–∏—á–∏—è –º–µ–∂–¥—É —Ö—Ä–∞–Ω–µ–Ω–∏–µ–º –¥–∞–Ω–Ω—ã—Ö –≤ cookie –∏ localStorage.
<h2>–ß—Ç–æ —Ç–∞–∫–æ–µ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –∏ —Å–µ—Å—Å–∏–∏</h2>
–ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è ‚Äî –ø—Ä–æ—Ü–µ—Å—Å –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –ª–∏—á–Ω–æ—Å—Ç–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.
–°–µ—Å—Å–∏—è ‚Äî —ç—Ç–æ —Å–ø–æ—Å–æ–± —Ö—Ä–∞–Ω–∏—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –º–µ–∂–¥—É –∑–∞–ø—Ä–æ—Å–∞–º–∏. –í –≤–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è—Ö —Å–µ—Å—Å–∏–∏ –Ω—É–∂–Ω—ã, —á—Ç–æ–±—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Å—Ç–∞–≤–∞–ª—Å—è ¬´–≤ —Å–∏—Å—Ç–µ–º–µ¬ª –±–µ–∑ –ø–æ–≤—Ç–æ—Ä–Ω–æ–≥–æ –ª–æ–≥–∏–Ω–∞ –Ω–∞ –∫–∞–∂–¥–æ–º –∑–∞–ø—Ä–æ—Å–µ.
<h2>JWT (JSON Web Token)</h2>
JWT ‚Äî —ç—Ç–æ –∫–æ–º–ø–∞–∫—Ç–Ω—ã–π —Ç–æ–∫–µ–Ω, –∫–æ—Ç–æ—Ä—ã–π –º–æ–∂–Ω–æ –ø–µ—Ä–µ–¥–∞–≤–∞—Ç—å –º–µ–∂–¥—É –∫–ª–∏–µ–Ω—Ç–æ–º –∏ —Å–µ—Ä–≤–µ—Ä–æ–º.
–û–Ω —Å–æ—Å—Ç–æ–∏—Ç –∏–∑ —Ç—Ä—ë—Ö —á–∞—Å—Ç–µ–π: header, payload –∏ signature.
–¢–æ–∫–µ–Ω —Å–æ–∑–¥–∞—ë—Ç—Å—è —Å–µ—Ä–≤–µ—Ä–æ–º –ø–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ –ª–æ–≥–∏–Ω–∞ –∏ –ø–æ–¥–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è —Å–µ–∫—Ä–µ—Ç–æ–º.
–ö–ª–∏–µ–Ω—Ç —Ö—Ä–∞–Ω–∏—Ç —Ç–æ–∫–µ–Ω –∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –µ–≥–æ –≤ –∫–∞–∂–¥–æ–º –∑–∞–ø—Ä–æ—Å–µ (–æ–±—ã—á–Ω–æ –≤ Authorization header).
<h2>Passport.js</h2>
Passport.js ‚Äî –ø–æ–ø—É–ª—è—Ä–Ω—ã–π middleware –¥–ª—è Node.js, –∫–æ—Ç–æ—Ä—ã–π —É–ø—Ä–æ—â–∞–µ—Ç –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—é.
–û–Ω –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –ª–æ–∫–∞–ª—å–Ω—ã–µ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ (–ª–æ–≥–∏–Ω + –ø–∞—Ä–æ–ª—å), OAuth (Google, Facebook), JWT –∏ –¥—Ä—É–≥–∏–µ.
–ü—Ä–∏–º–µ—Ä —Å –ª–æ–∫–∞–ª—å–Ω–æ–π —Å—Ç—Ä–∞—Ç–µ–≥–∏–µ–π:
<pre><code class="language-javascript">
const passport = require('passport');
const LocalStrategy = require('passport-local').Strategy;

passport.use(new LocalStrategy(
  function(username, password, done) {
    User.findOne({ username }, function(err, user) {
      if (err) return done(err);
      if (!user) return done(null, false);
      if (!user.verifyPassword(password)) return done(null, false);
      return done(null, user);
    });
  }
));
</code></pre>
<h2>Cookie vs localStorage</h2>
–û–±–∞ –≤–∞—Ä–∏–∞–Ω—Ç–∞ –º–æ–≥—É—Ç —Ö—Ä–∞–Ω–∏—Ç—å —Ç–æ–∫–µ–Ω—ã –∏–ª–∏ —Å–µ—Å—Å–∏–æ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ, –Ω–æ –µ—Å—Ç—å —Ä–∞–∑–ª–∏—á–∏—è:

Cookie
* –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å –∫–∞–∂–¥—ã–º HTTP-–∑–∞–ø—Ä–æ—Å–æ–º –∫ –¥–æ–º–µ–Ω—É.
* –ú–æ–∂–µ—Ç –±—ã—Ç—å HttpOnly ‚Äî –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞ –∏–∑ JS, –∑–∞—â–∏—â–∞–µ—Ç –æ—Ç XSS.
* –ú–æ–∂–Ω–æ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Å—Ä–æ–∫ –∂–∏–∑–Ω–∏, –¥–æ–º–µ–Ω –∏ –ø—É—Ç—å.

localStorage
* –î–æ—Å—Ç—É–ø–Ω–∞ —Ç–æ–ª—å–∫–æ —á–µ—Ä–µ–∑ JavaScript.
* –ù–µ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –Ω–∞ —Å–µ—Ä–≤–µ—Ä.
* –£—è–∑–≤–∏–º–∞ –∫ XSS, –Ω–æ –ø—Ä–æ—â–µ –¥–ª—è SPA (single-page applications).
<h2>–ü—Ä–∏–º–µ—Ä —Å JWT –∏ cookie</h2>
1. –°–µ—Ä–≤–µ—Ä —Å–æ–∑–¥–∞—ë—Ç JWT –ø–æ—Å–ª–µ –ª–æ–≥–∏–Ω–∞:
<pre><code class="language-javascript">
const jwt = require('jsonwebtoken');
const token = jwt.sign({ id: user.id }, 'secret', { expiresIn: '1h' });
res.cookie('token', token, { httpOnly: true });
res.send({ success: true });
</code></pre>
2. –ö–ª–∏–µ–Ω—Ç –ø—Ä–∏ –∫–∞–∂–¥–æ–º –∑–∞–ø—Ä–æ—Å–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç cookie –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏.
3. –ù–∞ —Å–µ—Ä–≤–µ—Ä–µ –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ç–æ–∫–µ–Ω–∞:
<pre><code class="language-javascript">
const token = req.cookies.token;
jwt.verify(token, 'secret', (err, decoded) => {
  if (err) return res.status(401).send('Unauthorized');
  req.user = decoded;
  next();
});
</code></pre>
<h2>–í—ã–≤–æ–¥</h2>
- –î–ª—è REST API –∏ SPA —á–∞—Å—Ç–æ –∏—Å–ø–æ–ª—å–∑—É—é—Ç JWT + localStorage.
- –î–ª—è —Ç—Ä–∞–¥–∏—Ü–∏–æ–Ω–Ω—ã—Ö —Å–µ—Ä–≤–µ—Ä–Ω—ã—Ö –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π —Å —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–æ–º HTML —É–¥–æ–±–Ω–µ–µ WT –∏–ª–∏ —Å–µ—Å—Å–∏–∏ –≤ HttpOnly cookie.
- Passport.js —É–ø—Ä–æ—â–∞–µ—Ç —Ä–∞–±–æ—Ç—É —Å —Ä–∞–∑–ª–∏—á–Ω—ã–º–∏ —Å—Ç—Ä–∞—Ç–µ–≥–∏—è–º–∏.

–ü—Ä–∞–≤–∏–ª—å–Ω–∞—è –∫–æ–º–±–∏–Ω–∞—Ü–∏—è –∑–∞–≤–∏—Å–∏—Ç –æ—Ç —Ç–∏–ø–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è, —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–π –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –∏ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã.

<h2>–ü—Ä–∏–º–µ—Ä –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ Node.js + Express —Å Passport.js, JWT –∏ cookie.</h2>
<h2>–£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π</h2>
–ü–µ—Ä–µ–¥ –Ω–∞—á–∞–ª–æ–º —É—Å—Ç–∞–Ω–æ–≤–∏–º –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –ø–∞–∫–µ—Ç—ã:
<pre><code class="language-javascript">
npm install express passport passport-local jsonwebtoken cookie-parser body-parser bcrypt
</code></pre>
<h2>–§—Ä–æ–Ω—Ç—ç–Ω–¥</h2>
HTML + jQuery —Ñ–æ—Ä–º–∞ –ª–æ–≥–∏–Ω–∞/–ª–æ–≥–∞—É—Ç–∞ + –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–æ—Ñ–∏–ª—è
<pre><code class="language-html">
<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>–ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è JWT + cookie</title>
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<body>
  <h2>–í—Ö–æ–¥</h2>
  <form id="loginForm">
    <input type="text" id="username" placeholder="–õ–æ–≥–∏–Ω" required><br>
    <input type="password" id="password" placeholder="–ü–∞—Ä–æ–ª—å" required><br>
    <button type="submit">–í–æ–π—Ç–∏</button>
  </form>

  <button id="logoutBtn" style="display:none;">–í—ã–π—Ç–∏</button>
  <button id="profileBtn" style="display:none;">–ú–æ–π –ø—Ä–æ—Ñ–∏–ª—å</button>

  <div id="output"></div>

  <script>
    // –õ–æ–≥–∏–Ω
    $('#loginForm').on('submit', function (e) {
      e.preventDefault();
      $.ajax({
        url: '/login',
        method: 'POST',
        contentType: 'application/json',
        data: JSON.stringify({
          username: $('#username').val(),
          password: $('#password').val()
        }),
        success: function (res) {
          $('#output').text(res.message);
          $('#loginForm').hide();
          $('#logoutBtn, #profileBtn').show();
        },
        error: function (xhr) {
          $('#output').text(xhr.responseJSON?.message || '–û—à–∏–±–∫–∞ –≤—Ö–æ–¥–∞');
        }
      });
    });

    // –ü—Ä–æ—Ñ–∏–ª—å
    $('#profileBtn').on('click', function () {
      $.ajax({
        url: '/profile',
        method: 'GET',
        success: function (res) {
          $('#output').text(res.message);
        },
        error: function () {
          $('#output').text('–ù–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω');
        }
      });
    });

    // –í—ã—Ö–æ–¥
    $('#logoutBtn').on('click', function () {
      $.ajax({
        url: '/logout',
        method: 'POST',
        success: function (res) {
          $('#output').text(res.message);
          $('#loginForm').show();
          $('#logoutBtn, #profileBtn').hide();
        }
      });
    });
  </script>
</body>
</html>
</code></pre>
<h2>app.js ‚Äî –æ—Å–Ω–æ–≤–Ω–æ–π —Å–µ—Ä–≤–µ—Ä</h2>
<pre><code class="language-javascript">
const express = require('express');
const passport = require('passport');
const LocalStrategy = require('passport-local').Strategy;
const jwt = require('jsonwebtoken');
const cookieParser = require('cookie-parser');
const bodyParser = require('body-parser');
const bcrypt = require('bcrypt');

const app = express();
const port = 3000;

// –§–µ–π–∫–æ–≤–∞—è –±–∞–∑–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π (—Å—Ä–∞–∑—É —Å —Ö–µ—à–µ–º)
const users = [
  { id: 1, username: 'user1', passwordHash: bcrypt.hashSync('password', 10) }
];

// Middleware
app.use(bodyParser.urlencoded({ extended: false }));
app.use(bodyParser.json());
app.use(cookieParser());
app.use(passport.initialize());

// –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ Passport.js (–ª–æ–≥–∏–Ω/–ø–∞—Ä–æ–ª—å)
passport.use(new LocalStrategy(
  function (username, password, done) {
    const user = users.find(u => u.username === username);
    if (!user) return done(null, false, { message: '–ù–µ–≤–µ—Ä–Ω—ã–π –ª–æ–≥–∏–Ω' });

    if (!bcrypt.compareSync(password, user.passwordHash)) {
      return done(null, false, { message: '–ù–µ–≤–µ—Ä–Ω—ã–π –ø–∞—Ä–æ–ª—å' });
    }

    return done(null, user);
  }
));

// –†–æ—É—Ç –ª–æ–≥–∏–Ω–∞
app.post('/login', (req, res, next) => {
  passport.authenticate('local', (err, user, info) => {
    if (err) return next(err);
    if (!user) return res.status(401).json({ success: false, message: info.message });

    // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è JWT
    const token = jwt.sign(
      { id: user.id, username: user.username },
      'secret',             // —Å–µ–∫—Ä–µ—Ç –¥–ª—è –ø–æ–¥–ø–∏—Å–∏ (–ª—É—á—à–µ –≤—ã–Ω–µ—Å—Ç–∏ –≤ .env)
      { expiresIn: '1h' }
    );

    // –û—Ç–ø—Ä–∞–≤–∫–∞ —Ç–æ–∫–µ–Ω–∞ –≤ cookie (HttpOnly)
    res.cookie('token', token, { httpOnly: true });
    res.json({ success: true, message: '–£—Å–ø–µ—à–Ω—ã–π –≤—Ö–æ–¥' });
  })(req, res, next); // –≤—ã–∑–æ–≤ –∫–æ–ª–±—ç–∫–∞ authenticate
});

// Middleware –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ JWT –∏–∑ cookie
function authenticateJWT(req, res, next) {
  const token = req.cookies.token;
  if (!token) return res.status(401).send('Unauthorized');

  jwt.verify(token, 'secret', (err, decoded) => {
    if (err) return res.status(401).send('Unauthorized');
    req.user = decoded;
    next();
  });
}

// –ü—Ä–∏–≤–∞—Ç–Ω—ã–π —Ä–æ—É—Ç
app.get('/profile', authenticateJWT, (req, res) => {
  res.json({ message: `–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å, ${req.user.username}` });
});

// Logout
app.post('/logout', (req, res) => {
  res.clearCookie('token');
  res.json({ success: true, message: '–í—ã –≤—ã—à–ª–∏' });
});

// –°—Ç–∞—Ä—Ç —Å–µ—Ä–≤–µ—Ä–∞
app.listen(port, () => console.log(`Server running on http://localhost:${port}`));

</code></pre>
<h2>–ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç</h2>
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç POST –Ω–∞ `/login` —Å `username` –∏ `password`.
- Passport –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –ª–æ–≥–∏–Ω –∏ –ø–∞—Ä–æ–ª—å.
- –ï—Å–ª–∏ –≤—Å—ë –≤–µ—Ä–Ω–æ, —Å–µ—Ä–≤–µ—Ä —Å–æ–∑–¥–∞—ë—Ç JWT –∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –µ–≥–æ –≤ HttpOnly cookie.
- –õ—é–±–æ–π —Ä–æ—É—Ç —Å middleware `authenticateJWT` –ø—Ä–æ–≤–µ—Ä—è–µ—Ç cookie –∏ —Ä–∞—Å—à–∏—Ñ—Ä–æ–≤—ã–≤–∞–µ—Ç —Ç–æ–∫–µ–Ω.
- Logout –ø—Ä–æ—Å—Ç–æ –æ—á–∏—â–∞–µ—Ç cookie.
<h2>–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å</h2>
- JWT –≤ cookie HttpOnly –∑–∞—â–∏—â–∞–µ—Ç –æ—Ç XSS.
- –î–ª—è SPA –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å localStorage, –Ω–æ —Ç–æ–≥–¥–∞ –Ω—É–∂–Ω–æ —É—á–∏—Ç—ã–≤–∞—Ç—å CSRF.
- Passport.js –ø–æ–∑–≤–æ–ª—è–µ—Ç –ª–µ–≥–∫–æ –ø–æ–¥–∫–ª—é—á–∞—Ç—å OAuth –∏ –¥—Ä—É–≥–∏–µ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏.

<h2>JWT –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è —á–µ—Ä–µ–∑ LocalStorage</h2>
–§—Ä–æ—Ç–Ω—ç–Ω–¥
<pre><code class="language-html">
<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>JWT + LocalStorage</title>
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <style>
    body { font-family: Arial, sans-serif; margin: 30px; }
    h1 { margin-bottom: 20px; }
    input, button { margin: 5px; padding: 6px; }
    pre { background: #f4f4f4; padding: 10px; border-radius: 5px; margin-top: 10px; }
  </style>
</head>
<body>
<h1>JWT –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è —á–µ—Ä–µ–∑ LocalStorage</h1>

<form id="loginForm">
  <input type="text" id="username" placeholder="–õ–æ–≥–∏–Ω" required>
  <input type="password" id="password" placeholder="–ü–∞—Ä–æ–ª—å" required>
  <button type="submit">–í–æ–π—Ç–∏</button>
</form>

<button id="getProfile">–ü—Ä–æ—Ñ–∏–ª—å</button>
<button id="logout">–í—ã–π—Ç–∏</button>

<pre id="output"></pre>

<script>
  const API = "http://localhost:3000";

  // –õ–æ–≥–∏–Ω
  $("#loginForm").submit(function(e) {
    e.preventDefault();
    $.post(API + "/login", {
      username: $("#username").val(),
      password: $("#password").val()
    }, function(data) {
      if (data.success && data.token) {
        localStorage.setItem("jwt", data.token);
      }
      $("#output").text(JSON.stringify(data, null, 2));
    }).fail(err => {
      $("#output").text("–û—à–∏–±–∫–∞: " + err.responseJSON?.message);
    });
  });

  // –ü—Ä–æ—Ñ–∏–ª—å
  $("#getProfile").click(function() {
    const token = localStorage.getItem("jwt");
    if (!token) return $("#output").text("–ù–µ—Ç —Ç–æ–∫–µ–Ω–∞ –≤ localStorage");

    $.ajax({
      url: API + "/profile",
      method: "GET",
      headers: { "Authorization": "Bearer " + token },
      success: function(data) {
        $("#output").text(JSON.stringify(data, null, 2));
      },
      error: function() {
        $("#output").text("–ù–µ—Ç –¥–æ—Å—Ç—É–ø–∞ (LocalStorage)");
      }
    });
  });

  // –í—ã—Ö–æ–¥
  $("#logout").click(function() {
    localStorage.removeItem("jwt");
    $("#output").text("–í—ã –≤—ã—à–ª–∏ (localStorage –æ—á–∏—â–µ–Ω)");
  });
</script>
</body>
</html>
</code></pre>
–°–µ—Ä–≤–µ—Ä
<pre><code class="language-javascript">
const express = require('express');
const jwt = require('jsonwebtoken');
const bodyParser = require('body-parser');
const bcrypt = require('bcrypt');
const cors = require('cors');

const app = express();
const port = 3000;

// –†–∞–∑—Ä–µ—à–∞–µ–º CORS (–¥–ª—è —Ñ—Ä–æ–Ω—Ç–∞)
app.use(cors());
app.use(bodyParser.json());
app.use(bodyParser.urlencoded({ extended: false }));

// –ú–æ–∫–∞–µ–º –±–∞–∑—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
const users = [
  { id: 1, username: 'user1', passwordHash: bcrypt.hashSync('password', 10) }
];

// –°–µ–∫—Ä–µ—Ç –¥–ª—è JWT
const SECRET = 'super_secret_key';

// –õ–æ–≥–∏–Ω ‚Äî –≤—ã–¥–∞—ë–º JWT
app.post('/login', (req, res) => {
  const { username, password } = req.body;
  const user = users.find(u => u.username === username);

  if (!user) {
    return res.status(401).json({ success: false, message: '–ù–µ–≤–µ—Ä–Ω—ã–π –ª–æ–≥–∏–Ω' });
  }
  if (!bcrypt.compareSync(password, user.passwordHash)) {
    return res.status(401).json({ success: false, message: '–ù–µ–≤–µ—Ä–Ω—ã–π –ø–∞—Ä–æ–ª—å' });
  }

  const token = jwt.sign({ id: user.id, username: user.username }, SECRET, { expiresIn: '1h' });
  res.json({ success: true, token });
});

// Middleware –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ JWT
function authenticateJWT(req, res, next) {
  const authHeader = req.headers['authorization'];
  if (!authHeader) return res.status(401).json({ message: '–ù–µ—Ç —Ç–æ–∫–µ–Ω–∞' });

  const token = authHeader.split(' ')[1];
  jwt.verify(token, SECRET, (err, decoded) => {
    if (err) return res.status(403).json({ message: '–ù–µ–¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã–π —Ç–æ–∫–µ–Ω' });
    req.user = decoded;
    next();
  });
}

// –ü—Ä–∏–≤–∞—Ç–Ω—ã–π —Ä–æ—É—Ç
app.get('/profile', authenticateJWT, (req, res) => {
  res.json({ message: `–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å, ${req.user.username}` });
});

app.listen(port, () => console.log(`üöÄ Server running on http://localhost:${port}`));
</code></pre>
<h2>–ó–∞–∫–ª—é—á–µ–Ω–∏–µ</h2>
–ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è ‚Äî —ç—Ç–æ –æ—Å–Ω–æ–≤–∞ –ª—é–±–æ–π —Å–æ–≤—Ä–µ–º–µ–Ω–Ω–æ–π –≤–µ–±-—Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏. Cookie –∏ LocalStorage, Passport.js –∏ JWT ‚Äî –≤—Å—ë —ç—Ç–æ –ª–∏—à—å –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã, –∫–æ—Ç–æ—Ä—ã–µ —Ä–µ—à–∞—é—Ç —Ä–∞–∑–Ω—ã–µ –∑–∞–¥–∞—á–∏. –ù–µ—Ç ¬´–ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ¬ª –∏–ª–∏ ¬´–Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ¬ª –≤–∞—Ä–∏–∞–Ω—Ç–∞ ‚Äî –µ—Å—Ç—å –ø–æ–¥—Ö–æ–¥—è—â–∏–π –¥–ª—è —Ç–≤–æ–µ–≥–æ –ø—Ä–æ–µ–∫—Ç–∞.

–ï—Å–ª–∏ –Ω—É–∂–µ–Ω –∫–ª–∞—Å—Å–∏—á–µ—Å–∫–∏–π –≤–µ–± —Å —Å–µ—Ä–≤–µ—Ä–Ω—ã–º–∏ —à–∞–±–ª–æ–Ω–∞–º–∏ ‚Äî –±–µ—Ä–∏ cookie + —Å–µ—Å—Å–∏–∏.
–ï—Å–ª–∏ —É —Ç–µ–±—è SPA –∏–ª–∏ –º–æ–±–∏–ª—å–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ ‚Äî —á–∞—â–µ –≤—Å–µ–≥–æ –ø–æ–¥–æ–π–¥—ë—Ç JWT —á–µ—Ä–µ–∑ localStorage –∏–ª–∏ cookie —Å HttpOnly.
Passport.js –∑–∞–∫—Ä—ã–≤–∞–µ—Ç –≤—Å–µ –≤–æ–ø—Ä–æ—Å—ã –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å–æ —Å—Ç–æ—Ä–æ–Ω–Ω–∏–º–∏ —Å–µ—Ä–≤–∏—Å–∞–º–∏, –∞ JWT —Ö–æ—Ä–æ—à —Ç–∞–º, –≥–¥–µ –Ω—É–∂–Ω–∞ –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å –∏ –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å—ã.

–ì–ª–∞–≤–Ω–æ–µ ‚Äî –≤—Å–µ–≥–¥–∞ –¥—É–º–∞—Ç—å –æ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏: —à–∏—Ñ—Ä–æ–≤–∞—Ç—å –¥–∞–Ω–Ω—ã–µ, —Å—Ç–∞–≤–∏—Ç—å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ —Ñ–ª–∞–≥–∏ –Ω–∞ cookie, –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å HTTPS –∏ –Ω–µ —Ö—Ä–∞–Ω–∏—Ç—å –ª–∏—à–Ω–µ–≥–æ –≤ localStorage.

–ò –ø–æ–º–Ω–∏: –∫–∞–∫ –±—ã —Å–ª–æ–∂–Ω–æ —ç—Ç–æ –Ω–∏ –∫–∞–∑–∞–ª–æ—Å—å, –ø–æ–¥ –∫–∞–ø–æ—Ç–æ–º –≤—Å—ë —Å–≤–æ–¥–∏—Ç—Å—è –∫ –ø—Ä–æ—Å—Ç–æ–º—É –ø—Ä–∞–≤–∏–ª—É ‚Äî —Ç—ã –¥–∞—ë—à—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é —Ç–æ–∫–µ–Ω, –∞ —Å–µ—Ä–≤–µ—Ä –ø—Ä–æ–≤–µ—Ä—è–µ—Ç, —á—Ç–æ –æ–Ω –Ω–∞—Å—Ç–æ—è—â–∏–π. –í—Å—ë –æ—Å—Ç–∞–ª—å–Ω–æ–µ ‚Äî –¥–µ—Ç–∞–ª–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏.