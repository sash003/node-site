
Node.js –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –º–æ—â–Ω—ã–π –º–æ–¥—É–ª—å fs –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å —Ñ–∞–π–ª–∞–º–∏ –∏ –∫–∞—Ç–∞–ª–æ–≥–∞–º–∏. –û–Ω –ø–æ–∑–≤–æ–ª—è–µ—Ç –∫–∞–∫ —Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ, —Ç–∞–∫ –∏ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ —á–∏—Ç–∞—Ç—å –∏ –∑–∞–ø–∏—Å—ã–≤–∞—Ç—å –¥–∞–Ω–Ω—ã–µ, —É–ø—Ä–∞–≤–ª—è—Ç—å –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è–º–∏, —Å–ª–µ–¥–∏—Ç—å –∑–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è–º–∏ —Ñ–∞–π–ª–æ–≤ –∏ —Å—Ç—Ä–æ–∏—Ç—å –Ω–∞ —ç—Ç–æ–º –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω—ã–µ —Å–µ—Ä–≤–µ—Ä–Ω—ã–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è. –í —ç—Ç–æ–π —Å—Ç–∞—Ç—å–µ –º—ã —Ä–∞–∑–±–µ—Ä—ë–º –æ—Å–Ω–æ–≤–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ fs, –Ω—é–∞–Ω—Å—ã –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ—Å—Ç–∏ –∏ –¥–∞–¥–∏–º –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–∏–º–µ—Ä—ã.
<h2>1. –ú–æ–¥—É–ª—å fs: —Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ –∏ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ –º–µ—Ç–æ–¥—ã</h2>
–í Node.js –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–æ –æ–ø–µ—Ä–∞—Ü–∏–π —Å —Ñ–∞–π–ª–∞–º–∏ –±—ã–≤–∞—é—Ç –¥–≤—É—Ö –≤–∏–¥–æ–≤:
–ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ ‚Äî –Ω–µ –±–ª–æ–∫–∏—Ä—É—é—Ç –æ—Å–Ω–æ–≤–Ω–æ–π –ø–æ—Ç–æ–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è, —Ä–∞–±–æ—Ç–∞—é—Ç —á–µ—Ä–µ–∑ –∫–æ–ª–±—ç–∫–∏ –∏–ª–∏ –ø—Ä–æ–º–∏—Å—ã.
–°–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ ‚Äî –±–ª–æ–∫–∏—Ä—É—é—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∫–æ–¥–∞ –¥–æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –æ–ø–µ—Ä–∞—Ü–∏–∏.

–ü—Ä–∏–º–µ—Ä –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è:
<pre><code class="language-javascript">
const fs = require('fs');
const path = require('path');
</code></pre>
–°–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–µ —á—Ç–µ–Ω–∏–µ —Ñ–∞–π–ª–∞
<pre><code class="language-javascript">
const data = fs.readFileSync(path.join(__dirname, 'example.txt'), 'utf-8');
console.log(data);
</code></pre>
‚ö†Ô∏è –ú–∏–Ω—É—Å —Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã—Ö –º–µ—Ç–æ–¥–æ–≤: –ø–æ–∫–∞ —Ñ–∞–π–ª —á–∏—Ç–∞–µ—Ç—Å—è, Node.js –Ω–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –¥—Ä—É–≥–∏–µ –∑–∞–ø—Ä–æ—Å—ã. –ü–æ—ç—Ç–æ–º—É –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ –æ–±—ã—á–Ω–æ –∏—Å–ø–æ–ª—å–∑—É—é—Ç –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ –º–µ—Ç–æ–¥—ã.

–ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–µ —á—Ç–µ–Ω–∏–µ —Ñ–∞–π–ª–∞ (–∫–æ–ª–±—ç–∫)
<pre><code class="language-javascript">
fs.readFile(path.join(__dirname, 'example.txt'), 'utf-8', (err, data) => {
  if (err) {
    console.error('–û—à–∏–±–∫–∞ —á—Ç–µ–Ω–∏—è —Ñ–∞–π–ª–∞:', err);
    return;
  }
  console.log(data);
});
</code></pre>
–ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–µ —á—Ç–µ–Ω–∏–µ —á–µ—Ä–µ–∑ –ø—Ä–æ–º–∏—Å—ã
<pre><code class="language-javascript">
const fsPromises = fs.promises;
async function readFileAsync() {
  try {
    const data = await fsPromises.readFile(path.join(__dirname, 'example.txt'), 'utf-8');
    console.log(data);
  } catch (err) {
    console.error('–û—à–∏–±–∫–∞:', err);
  }
}

readFileAsync();
</code></pre>
<h2>2. –ó–∞–ø–∏—Å—å —Ñ–∞–π–ª–æ–≤</h2>
Node.js –ø–æ–∑–≤–æ–ª—è–µ—Ç –∑–∞–ø–∏—Å—ã–≤–∞—Ç—å –¥–∞–Ω–Ω—ã–µ –≤ —Ñ–∞–π–ª –∫–∞–∫ —Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ, —Ç–∞–∫ –∏ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ.

–ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –∑–∞–ø–∏—Å—å —Å –∫–æ–ª–±—ç–∫–æ–º
<pre><code class="language-javascript">
fs.writeFile('output.txt', '–ü—Ä–∏–≤–µ—Ç, Node.js!', 'utf-8', (err) => {
  if (err) {
    console.error('–û—à–∏–±–∫–∞ –∑–∞–ø–∏—Å–∏:', err);
  } else {
    console.log('–§–∞–π–ª —É—Å–ø–µ—à–Ω–æ –∑–∞–ø–∏—Å–∞–Ω!');
  }
});
</code></pre>
–ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –∑–∞–ø–∏—Å—å —á–µ—Ä–µ–∑ –ø—Ä–æ–º–∏—Å—ã
<pre><code class="language-javascript">
async function writeFileAsync() {
  try {
    await fsPromises.writeFile('output.txt', '–ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –∑–∞–ø–∏—Å—å —á–µ—Ä–µ–∑ –ø—Ä–æ–º–∏—Å—ã', 'utf-8');
    console.log('–§–∞–π–ª –∑–∞–ø–∏—Å–∞–Ω!');
  } catch (err) {
    console.error('–û—à–∏–±–∫–∞:', err);
  }
}

writeFileAsync();
  </code></pre>
<h2>3. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è —Ñ–∞–π–ª–æ–≤ –∏ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π</h2>
–ß–∞—Å—Ç–æ –Ω—É–∂–Ω–æ —É–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ —Ñ–∞–π–ª –∏–ª–∏ –∫–∞—Ç–∞–ª–æ–≥ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –ø–µ—Ä–µ–¥ —á—Ç–µ–Ω–∏–µ–º –∏–ª–∏ –∑–∞–ø–∏—Å—å—é.
<pre><code class="language-javascript">
const filePath = path.join(__dirname, 'example.txt');
fs.access(filePath, fs.constants.F_OK, (err) => {
  if (err) {
    console.log('–§–∞–π–ª –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç');
  } else {
   console.log('–§–∞–π–ª —Å—É—â–µ—Å—Ç–≤—É–µ—Ç');
  }
});
</code></pre>
<h2>4. –†–∞–±–æ—Ç–∞ —Å –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è–º–∏</h2>
–°–æ–∑–¥–∞–Ω–∏–µ, —á—Ç–µ–Ω–∏–µ –∏ —É–¥–∞–ª–µ–Ω–∏–µ –ø–∞–ø–æ–∫ —Ç–∞–∫–∂–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ fs.

–°–æ–∑–¥–∞–Ω–∏–µ –ø–∞–ø–∫–∏
<pre><code class="language-javascript">
fs.mkdir(path.join(__dirname, 'uploads'), { recursive: true }, (err) => {
  if (err) console.error(err);
  else console.log('–ü–∞–ø–∫–∞ —Å–æ–∑–¥–∞–Ω–∞!');
});
</code></pre>
recursive: true –ø–æ–∑–≤–æ–ª—è–µ—Ç —Å–æ–∑–¥–∞–≤–∞—Ç—å –≤–ª–æ–∂–µ–Ω–Ω—ã–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏, –¥–∞–∂–µ –µ—Å–ª–∏ —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–∏–µ –Ω–µ —Å—É—â–µ—Å—Ç–≤—É—é—Ç.

–ß—Ç–µ–Ω–∏–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏
  <pre><code class="language-javascript">
fs.readdir(__dirname, (err, files) => {
if (err) console.error(err);
else console.log('–§–∞–π–ª—ã –≤ –ø–∞–ø–∫–µ:', files);
});
</code></pre>
–£–¥–∞–ª–µ–Ω–∏–µ –ø–∞–ø–∫–∏
<pre><code class="language-javascript">
fs.rmdir(path.join(__dirname, 'uploads'), { recursive: true }, (err) => {
  if (err) console.error(err);
  else console.log('–ü–∞–ø–∫–∞ —É–¥–∞–ª–µ–Ω–∞!');
});
</code></pre>
<h2>5. –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ—Å—Ç—å –∏ —Å–æ–±—ã—Ç–∏—è</h2>
–ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ –º–µ—Ç–æ–¥—ã –ø–æ–∑–≤–æ–ª—è—é—Ç –Ω–µ –±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å Event Loop. –ù–∞–ø—Ä–∏–º–µ—Ä, —Å–µ—Ä–≤–µ—Ä Node.js –º–æ–∂–µ—Ç –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å HTTP-–∑–∞–ø—Ä–æ—Å—ã, –ø–æ–∫–∞ —á–∏—Ç–∞–µ—Ç—Å—è —Ñ–∞–π–ª.
–î–ª—è –±–æ–ª—å—à–∏—Ö —Ñ–∞–π–ª–æ–≤ –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø–æ—Ç–æ–∫–∏ (Streams):
<pre><code class="language-javascript">
const readStream = fs.createReadStream('bigfile.txt', 'utf-8');

readStream.on('data', chunk => {
  console.log('–ü—Ä–æ—á–∏—Ç–∞–Ω–æ:', chunk.length, '—Å–∏–º–≤–æ–ª–æ–≤');
});

readStream.on('end', () => {
  console.log('–ß—Ç–µ–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–æ');
});
</code></pre>
–ò—Å–ø–æ–ª—å–∑—É—è –ø–æ—Ç–æ–∫–∏, –≤—ã –∏–∑–±–µ–≥–∞–µ—Ç–µ –∑–∞–≥—Ä—É–∑–∫–∏ –≤—Å–µ–≥–æ —Ñ–∞–π–ª–∞ –≤ –ø–∞–º—è—Ç—å.
<h2>6. –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–π –ø—Ä–∏–º–µ—Ä: –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–æ–≤</h2>
<pre><code class="language-javascript">
const http = require('http');

http.createServer(async (req, res) => {
  const logLine = `${new Date().toISOString()} ${req.method} ${req.url}\n`;

  await fsPromises.appendFile('server.log', logLine);

  res.end('OK');
}).listen(3000, () => console.log('–°–µ—Ä–≤–µ—Ä –Ω–∞ –ø–æ—Ä—Ç—É 3000'));
</code></pre>
–ó–¥–µ—Å—å appendFile –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ –¥–æ–±–∞–≤–ª—è–µ—Ç —Å—Ç—Ä–æ–∫–∏ –≤ –ª–æ–≥, –Ω–µ –±–ª–æ–∫–∏—Ä—É—è —Å–µ—Ä–≤–µ—Ä.
<h2>7. –°–æ–≤–µ—Ç—ã –ø–æ —Ä–∞–±–æ—Ç–µ —Å fs</h2>
–ò—Å–ø–æ–ª—å–∑—É–π –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ –º–µ—Ç–æ–¥—ã, –µ—Å–ª–∏ —ç—Ç–æ —Å–µ—Ä–≤–µ—Ä–Ω—ã–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è. –°–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ —Ç–æ–ª—å–∫–æ –¥–ª—è —Å–∫—Ä–∏–ø—Ç–æ–≤ –∏–ª–∏ CLI.
–ü—Ä–æ–≤–µ—Ä—è–π –æ—à–∏–±–∫–∏ –≤—Å–µ–≥–¥–∞, –æ—Å–æ–±–µ–Ω–Ω–æ –ø—Ä–∏ –∑–∞–ø–∏—Å–∏/—á—Ç–µ–Ω–∏–∏ —Ñ–∞–π–ª–æ–≤.
–ò—Å–ø–æ–ª—å–∑—É–π –ø–æ—Ç–æ–∫–∏ –¥–ª—è –±–æ–ª—å—à–∏—Ö —Ñ–∞–π–ª–æ–≤ ‚Äî —ç–∫–æ–Ω–æ–º–∏—Ç –ø–∞–º—è—Ç—å.
–°—Ç–∞—Ä–∞–π—Å—è —Ö—Ä–∞–Ω–∏—Ç—å –ø—É—Ç–∏ —á–µ—Ä–µ–∑ path.join, —á—Ç–æ–±—ã –∫–æ–¥ –±—ã–ª –∫—Ä–æ—Å—Å–ø–ª–∞—Ç—Ñ–æ—Ä–º–µ–Ω–Ω—ã–º.
Node.js –∏ –º–æ–¥—É–ª—å fs –¥–∞—é—Ç –ø–æ–ª–Ω—ã–π –∫–æ–Ω—Ç—Ä–æ–ª—å –Ω–∞–¥ —Ñ–∞–π–ª–æ–≤–æ–π —Å–∏—Å—Ç–µ–º–æ–π —Å–µ—Ä–≤–µ—Ä–∞. –ó–Ω–∞—è, –∫–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ—Å—Ç—å, –ø–æ—Ç–æ–∫–∏ –∏ –ø—Ä–æ–º–∏—Å—ã, –º–æ–∂–Ω–æ —Å—Ç—Ä–æ–∏—Ç—å –Ω–∞–¥—ë–∂–Ω—ã–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è —Å –ª–æ–≥–∞–º–∏, –∑–∞–≥—Ä—É–∑–∫–æ–π —Ñ–∞–π–ª–æ–≤, –≥–µ–Ω–µ—Ä–∞—Ü–∏–µ–π –∫–æ–Ω—Ç–µ–Ω—Ç–∞ –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ–º –ø–∞–ø–∫–∞–º–∏ –±–µ–∑ —Ä–∏—Å–∫–∞ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ —Å–µ—Ä–≤–µ—Ä–∞.
  <h2>8. –ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–æ–≤: multer + file-type</h2>
–í –≤–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è—Ö —á–∞—Å—Ç–æ –Ω—É–∂–Ω–æ –ø—Ä–∏–Ω–∏–º–∞—Ç—å —Ñ–∞–π–ª—ã –æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π ‚Äî –∫–∞—Ä—Ç–∏–Ω–∫–∏, –¥–æ–∫—É–º–µ–Ω—Ç—ã –∏–ª–∏ –≤–∏–¥–µ–æ. –î–ª—è —ç—Ç–æ–≥–æ –≤ Node.js –µ—Å—Ç—å –ø–æ–ø—É–ª—è—Ä–Ω—ã–π middleware multer.

–£—Å—Ç–∞–Ω–æ–≤–∫–∞:
<pre><code class="language-javascript">
npm install multer file-type
</code></pre>
–ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞
<pre><code class="language-javascript">
const multer = require('multer');
const fs = require('fs');
const path = require('path');
const FileType = require('file-type');

// –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º —Ö—Ä–∞–Ω–∏–ª–∏—â–µ –¥–ª—è –∑–∞–≥—Ä—É–∂–∞–µ–º—ã—Ö —Ñ–∞–π–ª–æ–≤ —á–µ—Ä–µ–∑ multer
const storage = multer.diskStorage({
   /* –ö—É–¥–∞ —Å–æ—Ö—Ä–∞–Ω—è—Ç—å —Ñ–∞–π–ª
   –§—É–Ω–∫—Ü–∏—è –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Ñ–∞–π–ª–∞
   req  ‚Äì –¥–∞–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å–∞
   file ‚Äì –æ–±—ä–µ–∫—Ç —Å –∏–Ω—Ñ–æ–π –æ —Ñ–∞–π–ª–µ (–∏–º—è, —Ç–∏–ø –∏ —Ç.–¥.)
   cb   ‚Äì –∫–æ–ª–±—ç–∫, —É–∫–∞–∑—ã–≤–∞–µ–º multer –∫—É–¥–∞ –∫–ª–∞—Å—Ç—å —Ñ–∞–π–ª */
  destination: (req, file, cb) => {
    // –ü—É—Ç—å –¥–æ –ø–∞–ø–∫–∏ uploads –≤–Ω—É—Ç—Ä–∏ public
    const uploadDir = path.join(__dirname, 'public', 'uploads');

    // –ï—Å–ª–∏ –ø–∞–ø–∫–∏ –µ—â—ë –Ω–µ—Ç ‚Äî —Å–æ–∑–¥–∞—ë–º (recursive: true —Å–æ–∑–¥–∞—Å—Ç –≤—Å–µ –≤–ª–æ–∂–µ–Ω–Ω—ã–µ, –µ—Å–ª–∏ –Ω—É–∂–Ω–æ)
    if (!fs.existsSync(uploadDir)) {
      fs.mkdirSync(uploadDir, { recursive: true });
    }

    // –°–æ–æ–±—â–∞–µ–º multer, –∫—É–¥–∞ –∏–º–µ–Ω–Ω–æ —Å–æ—Ö—Ä–∞–Ω—è—Ç—å —Ñ–∞–π–ª
    cb(null, uploadDir);
  },

  // –ö–∞–∫ –Ω–∞–∑–≤–∞—Ç—å —Ñ–∞–π–ª –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏
  filename: (req, file, cb) => {
    // –î–µ–ª–∞–µ–º —É–Ω–∏–∫–∞–ª—å–Ω–æ–µ –∏–º—è: timestamp + –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ–µ –∏–º—è —Ñ–∞–π–ª–∞
    // –ù–∞–ø—Ä–∏–º–µ—Ä: 1692718200000-photo.png
    const uniqueName = Date.now() + '-' + file.originalname;

    // –°–æ–æ–±—â–∞–µ–º multer –Ω–æ–≤–æ–µ –∏–º—è
    cb(null, uniqueName);
  }
});

// –°–æ–±–∏—Ä–∞–µ–º —Å–∞–º middleware –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏
const upload = multer({
  storage, // –∏—Å–ø–æ–ª—å–∑—É–µ–º —Ö—Ä–∞–Ω–∏–ª–∏—â–µ, —á—Ç–æ –Ω–∞—Å—Ç—Ä–æ–∏–ª–∏ –≤—ã—à–µ
  limits: {
    fileSize: 10 * 1024 * 1024 // –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ: 10 –ú–ë –Ω–∞ –æ–¥–∏–Ω —Ñ–∞–π–ª
  }
}).any(); // .any() –∑–Ω–∞—á–∏—Ç –ø—Ä–∏–Ω–∏–º–∞—Ç—å —Ñ–∞–π–ª—ã —Å –ª—é–±—ã–º–∏ –∏–º–µ–Ω–∞–º–∏ input'–æ–≤. –ï—Å–ª–∏ —Ö–æ—á–µ—à—å —Å–¥–µ–ª–∞—Ç—å –∂—ë—Å—Ç—á–µ (–Ω–∞–ø—Ä–∏–º–µ—Ä, —á—Ç–æ–±—ã –∑–∞–≥—Ä—É–∂–∞–ª–æ—Å—å –º–∞–∫—Å–∏–º—É–º 3 —Ñ–∞–π–ª–∞), –º–æ–∂–Ω–æ —Ç—É—Ç –∂–µ –≤–º–µ—Å—Ç–æ .any() –Ω–∞–ø–∏—Å–∞—Ç—å .array('files', 3) ‚Äî –∏ –≤—Å—ë, multer —Å–∞–º –æ–±—Ä–µ–∂–µ—Ç –¥–æ —Ç—Ä—ë—Ö.
</code></pre>
–ü—Ä–æ–≤–µ—Ä–∫–∞ —Ñ–æ—Ä–º–∞—Ç–∞ —Ñ–∞–π–ª–∞

–î–∞–∂–µ –µ—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–µ—Ä–µ–∏–º–µ–Ω—É–µ—Ç —Ñ–∞–π–ª (–Ω–∞–ø—Ä–∏–º–µ—Ä, virus.jpg.exe), –º—ã –º–æ–∂–µ–º –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–µ–∞–ª—å–Ω—ã–π MIME-—Ç–∏–ø —á–µ—Ä–µ–∑ file-type:
<pre><code class="language-javascript">
async function checkFileType(filePath) {
  const buffer = await fs.promises.readFile(filePath);
  const type = await FileType.fromBuffer(buffer);
  return type ? type.mime : null;
}
</code></pre>
–û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–∞–π–ª–æ–≤
<pre><code class="language-javascript">
const express = require('express');
const app = express();

const ALLOWED_MIME = [
  'image/png',
  'image/jpeg',
  'image/gif',
  'video/mp4',
  'audio/mpeg',
  'application/pdf'
];

app.post('/upload', (req, res) => {
  upload(req, res, async (err) => {
    if (err) {
      return res.status(400).json({ success: false, message: '–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏: ' + err.message });
    }

    const files = req.files || [];

    for (const f of files) {
      const filePath = path.join(f.destination, f.filename);
      const mime = await checkFileType(filePath);

      if (!mime || !ALLOWED_MIME.includes(mime)) {
        fs.unlinkSync(filePath); // —É–¥–∞–ª—è–µ–º –Ω–µ–ø–æ–¥—Ö–æ–¥—è—â–∏–π —Ñ–∞–π–ª
        return res.json({ success: false, message: '–ù–µ–¥–æ–ø—É—Å—Ç–∏–º—ã–π —Ñ–æ—Ä–º–∞—Ç —Ñ–∞–π–ª–∞' });
      }
    }

    res.json({ success: true, message: '–§–∞–π–ª—ã —É—Å–ø–µ—à–Ω–æ –∑–∞–≥—Ä—É–∂–µ–Ω—ã!' });
  });
});

app.listen(3000, () => console.log('–°–µ—Ä–≤–µ—Ä —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ http://localhost:3000'));
</code></pre>
–ß—Ç–æ –º—ã –ø–æ–ª—É—á–∏–ª–∏

–ó–∞–≥—Ä—É–∂–∞–µ–º —Ñ–∞–π–ª—ã –≤ –ø–∞–ø–∫—É public/uploads.
–û–≥—Ä–∞–Ω–∏—á–∏–ª–∏ —Ä–∞–∑–º–µ—Ä –¥–æ 10 –ú–ë.
–ü—Ä–æ–≤–µ—Ä—è–µ–º —Ä–µ–∞–ª—å–Ω—ã–π MIME-—Ç–∏–ø —á–µ—Ä–µ–∑ file-type, –∞ –Ω–µ —Ç–æ–ª—å–∫–æ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ.
–ï—Å–ª–∏ —Ñ–æ—Ä–º–∞—Ç –Ω–µ –ø–æ–¥—Ö–æ–¥–∏—Ç, —Ñ–∞–π–ª —É–¥–∞–ª—è–µ—Ç—Å—è.

üí° –í —Ä–µ–∞–ª—å–Ω—ã—Ö –ø—Ä–æ–µ–∫—Ç–∞—Ö –∫ —ç—Ç–æ–º—É –¥–æ–±–∞–≤–ª—è—é—Ç –µ—â—ë –ª–∏–º–∏—Ç –ø–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤—É —Ñ–∞–π–ª–æ–≤, –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫—É—é –æ—á–∏—Å—Ç–∫—É –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π –∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ —Ñ–∞–π–ª–∞—Ö –≤ –ë–î.

–¢–∞–∫–∏–º –æ–±—Ä–∞–∑–æ–º, fs + multer + file-type –ø–æ–∑–≤–æ–ª—è—é—Ç –±–µ–∑–æ–ø–∞—Å–Ω–æ –∏ —É–¥–æ–±–Ω–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –∑–∞–≥—Ä—É–∑–∫—É —Ñ–∞–π–ª–æ–≤ –≤ Node.js, –Ω–µ —Ä–∏—Å–∫—É—è –¥–æ–ø—É—Å—Ç–∏—Ç—å —É—è–∑–≤–∏–º–æ—Å—Ç–∏.